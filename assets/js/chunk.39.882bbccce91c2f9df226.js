/*! For license information please see chunk.39.882bbccce91c2f9df226.js.LICENSE.txt */
"use strict";(self.webpackChunkultimate_jekyll=self.webpackChunkultimate_jekyll||[]).push([[39],{39:function(t,e,n){n.r(e);var r,s=n(925),i=n(463),o=n(537),a=n(555),c=n(994),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h={},l=l||{},d=u||self;function f(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function m(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),p=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function w(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:w).apply(null,arguments)}function b(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function I(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function T(){this.s=this.s,this.o=this.o}T.prototype.s=!1,T.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,g)&&t[g]||(t[g]=++p))},T.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function _(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function S(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(f(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function x(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}x.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{d.addEventListener("test",(()=>{}),e),d.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function C(t){return/^[\s\xa0]*$/.test(t)}function A(){var t=d.navigator;return t&&(t=t.userAgent)?t:""}function N(t){return-1!=A().indexOf(t)}function k(t){return k[" "](t),t}k[" "]=function(){};var R,M,F,O=N("Opera"),L=N("Trident")||N("MSIE"),P=N("Edge"),V=P||L,q=N("Gecko")&&!(-1!=A().toLowerCase().indexOf("webkit")&&!N("Edge"))&&!(N("Trident")||N("MSIE"))&&!N("Edge"),B=-1!=A().toLowerCase().indexOf("webkit")&&!N("Edge");function U(){var t=d.document;return t?t.documentMode:void 0}t:{var j="",G=(M=A(),q?/rv:([^\);]+)(\)|;)/.exec(M):P?/Edge\/([\d\.]+)/.exec(M):L?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(M):B?/WebKit\/(\S+)/.exec(M):O?/(?:Version)[ \/]?(\S+)/.exec(M):void 0);if(G&&(j=G?G[1]:""),L){var z=U();if(null!=z&&z>parseFloat(j)){R=String(z);break t}}R=j}if(d.document&&L){var K=U();F=K||(parseInt(R,10)||void 0)}else F=void 0;var $=F;function Q(t,e){if(x.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(q){t:{try{k(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:W[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Q.$.h.call(this)}}I(Q,x);var W={2:"touch",3:"pen",4:"mouse"};Q.prototype.h=function(){Q.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var H="closure_listenable_"+(1e6*Math.random()|0),X=0;function Y(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=s,this.key=++X,this.fa=this.ia=!1}function J(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Z(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function tt(t){const e={};for(const n in t)e[n]=t[n];return e}const et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nt(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<et.length;e++)n=et[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function rt(t){this.src=t,this.g={},this.h=0}function st(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=E(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(J(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function it(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==r)return s}return-1}rt.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=it(t,e,r,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new Y(e,this.src,i,!!r,s)).ia=n,t.push(e)),e};var ot="closure_lm_"+(1e6*Math.random()|0),at={};function ct(t,e,n,r,s){if(r&&r.once)return ht(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)ct(t,e[i],n,r,s);return null}return n=yt(n),t&&t[H]?t.O(e,n,m(r)?!!r.capture:!!r,s):ut(t,e,n,!1,r,s)}function ut(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=m(s)?!!s.capture:!!s,a=gt(t);if(a||(t[ot]=a=new rt(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}const e=mt;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)D||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(ft(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ht(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)ht(t,e[i],n,r,s);return null}return n=yt(n),t&&t[H]?t.P(e,n,m(r)?!!r.capture:!!r,s):ut(t,e,n,!0,r,s)}function lt(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)lt(t,e[i],n,r,s);else r=m(r)?!!r.capture:!!r,n=yt(n),t&&t[H]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=it(i=t.g[e],n,r,s))&&(J(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--)))):t&&(t=gt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=it(e,n,r,s)),(n=-1<t?e[t]:null)&&dt(n))}function dt(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[H])st(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(ft(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=gt(e))?(st(n,t),0==n.h&&(n.src=null,e[ot]=null)):J(t)}}}function ft(t){return t in at?at[t]:at[t]="on"+t}function mt(t,e){if(t.fa)t=!0;else{e=new Q(e,this);var n=t.listener,r=t.la||t.src;t.ia&&dt(t),t=n.call(r,e)}return t}function gt(t){return(t=t[ot])instanceof rt?t:null}var pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function yt(t){return"function"==typeof t?t:(t[pt]||(t[pt]=function(e){return t.handleEvent(e)}),t[pt])}function wt(){T.call(this),this.i=new rt(this),this.S=this,this.J=null}function vt(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new x(e,t);else if(e instanceof x)e.target=e.target||t;else{var s=e;nt(e=new x(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=bt(o,r,!0,e)&&s}if(s=bt(o=e.g=t,r,!0,e)&&s,s=bt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=bt(o=e.g=n[i],r,!1,e)&&s}function bt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&st(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}I(wt,T),wt.prototype[H]=!0,wt.prototype.removeEventListener=function(t,e,n,r){lt(this,t,e,n,r)},wt.prototype.N=function(){if(wt.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)J(n[r]);delete e.g[t],e.h--}}this.J=null},wt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},wt.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var It=d.JSON.stringify;function Tt(){var t=At;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Et=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new _t),(t=>t.reset()));class _t{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function St(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function xt(t){d.setTimeout((()=>{throw t}),0)}let Dt,Ct=!1,At=new class{constructor(){this.h=this.g=null}add(t,e){const n=Et.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Nt=()=>{const t=d.Promise.resolve(void 0);Dt=()=>{t.then(kt)}};var kt=()=>{for(var t;t=Tt();){try{t.h.call(t.g)}catch(t){xt(t)}var e=Et;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Ct=!1};function Rt(t,e){wt.call(this),this.h=t||1,this.g=e||d,this.j=v(this.qb,this),this.l=Date.now()}function Mt(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Ft(t,e,n){if("function"==typeof t)n&&(t=v(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=v(t.handleEvent,t)}return 2147483647<Number(e)?-1:d.setTimeout(t,e||0)}function Ot(t){t.g=Ft((()=>{t.g=null,t.i&&(t.i=!1,Ot(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}I(Rt,wt),(r=Rt.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),vt(this,"tick"),this.ga&&(Mt(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){Rt.$.N.call(this),Mt(this),delete this.g};class Lt extends T{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Ot(this)}N(){super.N(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pt(t){T.call(this),this.h=t,this.g={}}I(Pt,T);var Vt=[];function qt(t,e,n,r){Array.isArray(n)||(n&&(Vt[0]=n.toString()),n=Vt);for(var s=0;s<n.length;s++){var i=ct(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function Bt(t){Z(t.g,(function(t,e){this.g.hasOwnProperty(e)&&dt(t)}),t),t.g={}}function Ut(){this.g=!0}function jt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return It(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Pt.prototype.N=function(){Pt.$.N.call(this),Bt(this)},Pt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ut.prototype.Ea=function(){this.g=!1},Ut.prototype.info=function(){};var Gt={},zt=null;function Kt(){return zt=zt||new wt}function $t(t){x.call(this,Gt.Ta,t)}function Qt(t){const e=Kt();vt(e,new $t(e))}function Wt(t,e){x.call(this,Gt.STAT_EVENT,t),this.stat=e}function Ht(t){const e=Kt();vt(e,new Wt(e,t))}function Xt(t,e){x.call(this,Gt.Ua,t),this.size=e}function Yt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return d.setTimeout((function(){t()}),e)}Gt.Ta="serverreachability",I($t,x),Gt.STAT_EVENT="statevent",I(Wt,x),Gt.Ua="timingevent",I(Xt,x);var Jt={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Zt={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function te(){}function ee(t){return t.h||(t.h=t.i())}function ne(){}te.prototype.h=null;var re,se={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ie(){x.call(this,"d")}function oe(){x.call(this,"c")}function ae(){}function ce(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Pt(this),this.P=he,t=V?125:void 0,this.V=new Rt(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ue}function ue(){this.i=null,this.g="",this.h=!1}I(ie,x),I(oe,x),I(ae,te),ae.prototype.g=function(){return new XMLHttpRequest},ae.prototype.i=function(){return{}},re=new ae;var he=45e3,le={},de={};function fe(t,e,n){t.L=1,t.v=Re(De(e)),t.s=n,t.S=!0,me(t,null)}function me(t,e){t.G=Date.now(),we(t),t.A=De(t.v);var n=t.A,r=t.W;Array.isArray(r)||(r=[String(r)]),Ke(n.i,"t",r),t.C=0,n=t.l.J,t.h=new ue,t.g=$n(t.l,n?e:null,!t.s),0<t.O&&(t.M=new Lt(v(t.Pa,t,t.g),t.O)),qt(t.U,t.g,"readystatechange",t.nb),e=t.I?tt(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),Qt(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function ge(t){return!!t.g&&("GET"==t.u&&2!=t.L&&t.l.Ha)}function pe(t,e,n){let r,s=!0;for(;!t.J&&t.C<n.length;){if(r=ye(t,n),r==de){4==e&&(t.o=4,Ht(14),s=!1),jt(t.j,t.m,null,"[Incomplete Response]");break}if(r==le){t.o=4,Ht(15),jt(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}jt(t.j,t.m,r,null),Ee(t,r)}ge(t)&&r!=de&&r!=le&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Ht(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Vn(e),e.M=!0,Ht(11))):(jt(t.j,t.m,n,"[Invalid Chunked Response]"),Te(t),Ie(t))}function ye(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?de:(n=Number(e.substring(n,r)),isNaN(n)?le:(r+=1)+n>e.length?de:(e=e.slice(r,r+n),t.C=r+n,e))}function we(t){t.Y=Date.now()+t.P,ve(t,t.P)}function ve(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Yt(v(t.lb,t),e)}function be(t){t.B&&(d.clearTimeout(t.B),t.B=null)}function Ie(t){0==t.l.H||t.J||Un(t.l,t)}function Te(t){be(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Mt(t.V),Bt(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Ee(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Je(n.i,t)))if(!t.K&&Je(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Bn(n),Nn(n)}Pn(n),Ht(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=Yt(v(n.ib,n),6e3));if(1>=Ye(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Gn(n,11)}else if((t.K||n.g==t)&&Bn(n),!C(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=u[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Ze(i,i.h),i.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,ke(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Kn(r,r.J?r.pa:null,r.Y),o.K){tn(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(be(a),we(a)),r.g=o}else Ln(r);0<n.j.length&&Rn(n)}else"stop"!=u[0]&&"close"!=u[0]||Gn(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Gn(n,7):An(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Qt()}catch(t){}}function _e(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(f(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(f(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(f(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}(r=ce.prototype).setTimeout=function(t){this.P=t},r.nb=function(t){t=t.target;const e=this.M;e&&3==En(t)?e.l():this.Pa(t)},r.Pa=function(t){try{if(t==this.g)t:{const h=En(this.g);var e=this.g.Ia();this.g.da();if(!(3>h)&&(3!=h||V||this.g&&(this.h.h||this.g.ja()||_n(this.g)))){this.J||4!=h||7==e||Qt(),be(this);var n=this.g.da();this.ca=n;e:if(ge(this)){var r=_n(this.g);t="";var s=r.length,i=4==En(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Te(this),Ie(this);var o="";break e}this.h.i=new d.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,Ht(12),Te(this),Ie(this);break t}jt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ee(this,n)}this.S?(pe(this,h,o),V&&this.i&&3==h&&(qt(this.U,this.V,"tick",this.mb),this.V.start())):(jt(this.j,this.m,o,null),Ee(this,o)),4==h&&Te(this),this.i&&!this.J&&(4==h?Un(this.l,this):(this.i=!1,we(this)))}else(function(t){const e={};t=(t.g&&2<=En(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(C(t[r]))continue;var n=St(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Ht(12)):(this.o=0,Ht(13)),Te(this),Ie(this)}}}catch(t){}},r.mb=function(){if(this.g){var t=En(this.g),e=this.g.ja();this.C<e.length&&(be(this),pe(this,t,e),this.i&&4!=t&&we(this))}},r.cancel=function(){this.J=!0,Te(this)},r.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(Qt(),Ht(17)),Te(this),this.o=2,Ie(this)):ve(this,this.Y-t)};var Se=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xe(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof xe){this.h=t.h,Ce(this,t.j),this.s=t.s,this.g=t.g,Ae(this,t.m),this.l=t.l;var e=t.i,n=new Ue;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Ne(this,n),this.o=t.o}else t&&(e=String(t).match(Se))?(this.h=!1,Ce(this,e[1]||"",!0),this.s=Me(e[2]||""),this.g=Me(e[3]||"",!0),Ae(this,e[4]),this.l=Me(e[5]||"",!0),Ne(this,e[6]||"",!0),this.o=Me(e[7]||"")):(this.h=!1,this.i=new Ue(null,this.h))}function De(t){return new xe(t)}function Ce(t,e,n){t.j=n?Me(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ae(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ne(t,e,n){e instanceof Ue?(t.i=e,function(t,e){e&&!t.j&&(je(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ge(this,e),Ke(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Fe(e,qe)),t.i=new Ue(e,t.h))}function ke(t,e,n){t.i.set(e,n)}function Re(t){return ke(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Me(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Fe(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Oe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Oe(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}xe.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Fe(e,Le,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Fe(e,Le,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Fe(n,"/"==n.charAt(0)?Ve:Pe,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Fe(n,Be)),t.join("")};var Le=/[#\/\?@]/g,Pe=/[#\?:]/g,Ve=/[#\?]/g,qe=/[#\?@]/g,Be=/#/g;function Ue(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function je(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Ge(t,e){je(t),e=$e(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function ze(t,e){return je(t),e=$e(t,e),t.g.has(e)}function Ke(t,e,n){Ge(t,e),0<n.length&&(t.i=null,t.g.set($e(t,e),_(n)),t.h+=n.length)}function $e(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(r=Ue.prototype).add=function(t,e){je(this),this.i=null,t=$e(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},r.forEach=function(t,e){je(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},r.ta=function(){je(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},r.Z=function(t){je(this);let e=[];if("string"==typeof t)ze(this,t)&&(e=e.concat(this.g.get($e(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},r.set=function(t,e){return je(this),this.i=null,ze(this,t=$e(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},r.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};var Qe=class{constructor(t,e){this.g=t,this.map=e}};function We(t){this.l=t||He,d.PerformanceNavigationTiming?t=0<(t=d.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(d.g&&d.g.Ka&&d.g.Ka()&&d.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var He=10;function Xe(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Ye(t){return t.h?1:t.g?t.g.size:0}function Je(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Ze(t,e){t.g?t.g.add(e):t.h=e}function tn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function en(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return _(t.i)}We.prototype.cancel=function(){if(this.i=en(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var nn=class{stringify(t){return d.JSON.stringify(t,void 0)}parse(t){return d.JSON.parse(t,void 0)}};function rn(){this.g=new nn}function sn(t,e,n){const r=n||"";try{_e(t,(function(t,n){let s=t;m(t)&&(s=It(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function on(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function an(t){this.l=t.fc||null,this.j=t.ob||!1}function cn(t,e){wt.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=un,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}I(an,te),an.prototype.g=function(){return new cn(this.l,this.j)},an.prototype.i=function(t){return function(){return t}}({}),I(cn,wt);var un=0;function hn(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function ln(t){t.readyState=4,t.l=null,t.j=null,t.A=null,dn(t)}function dn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(r=cn.prototype).open=function(t,e){if(this.readyState!=un)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,dn(this)},r.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||d).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ln(this)),this.readyState=un},r.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,dn(this)),this.g&&(this.readyState=3,dn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==d.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;hn(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?ln(this):dn(this),3==this.readyState&&hn(this)}},r.Za=function(t){this.g&&(this.response=this.responseText=t,ln(this))},r.Ya=function(t){this.g&&(this.response=t,ln(this))},r.ka=function(){this.g&&ln(this)},r.setRequestHeader=function(t,e){this.v.append(t,e)},r.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(cn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var fn=d.JSON.parse;function mn(t){wt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=gn,this.L=this.M=!1}I(mn,wt);var gn="",pn=/^https?$/i,yn=["POST","PUT"];function wn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,vn(t),In(t)}function vn(t){t.F||(t.F=!0,vt(t,"complete"),vt(t,"error"))}function bn(t){if(t.h&&void 0!==l&&(!t.C[1]||4!=En(t)||2!=t.da()))if(t.v&&4==En(t))Ft(t.La,0,t);else if(vt(t,"readystatechange"),4==En(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var s=String(t.I).match(Se)[1]||null;!s&&d.self&&d.self.location&&(s=d.self.location.protocol.slice(0,-1)),r=!pn.test(s?s.toLowerCase():"")}n=r}if(n)vt(t,"complete"),vt(t,"success");else{t.m=6;try{var i=2<En(t)?t.g.statusText:""}catch(t){i=""}t.j=i+" ["+t.da()+"]",vn(t)}}finally{In(t)}}}function In(t,e){if(t.g){Tn(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||vt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Tn(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(d.clearTimeout(t.A),t.A=null)}function En(t){return t.g?t.g.readyState:0}function _n(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case gn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Sn(t){let e="";return Z(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function xn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Sn(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ke(t,e,n))}function Dn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Cn(t){this.Ga=0,this.j=[],this.l=new Ut,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Dn("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Dn("baseRetryDelayMs",5e3,t),this.hb=Dn("retryDelaySeedMs",1e4,t),this.eb=Dn("forwardChannelMaxRetries",2,t),this.xa=Dn("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new We(t&&t.concurrentRequestLimit),this.Ja=new rn,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function An(t){if(kn(t),3==t.H){var e=t.W++,n=De(t.I);if(ke(n,"SID",t.K),ke(n,"RID",e),ke(n,"TYPE","terminate"),Fn(t,n),(e=new ce(t,t.l,e)).L=2,e.v=Re(De(n)),n=!1,d.navigator&&d.navigator.sendBeacon)try{n=d.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&d.Image&&((new Image).src=e.v,n=!0),n||(e.g=$n(e.l,null),e.g.ha(e.v)),e.G=Date.now(),we(e)}zn(t)}function Nn(t){t.g&&(Vn(t),t.g.cancel(),t.g=null)}function kn(t){Nn(t),t.u&&(d.clearTimeout(t.u),t.u=null),Bn(t),t.i.cancel(),t.m&&("number"==typeof t.m&&d.clearTimeout(t.m),t.m=null)}function Rn(t){if(!Xe(t.i)&&!t.m){t.m=!0;var e=t.Na;Dt||Nt(),Ct||(Dt(),Ct=!0),At.add(e,t),t.C=0}}function Mn(t,e){var n;n=e?e.m:t.W++;const r=De(t.I);ke(r,"SID",t.K),ke(r,"RID",n),ke(r,"AID",t.V),Fn(t,r),t.o&&t.s&&xn(r,t.o,t.s),n=new ce(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=On(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Ze(t.i,n),fe(n,r,e)}function Fn(t,e){t.na&&Z(t.na,(function(t,n){ke(e,n,t)})),t.h&&_e({},(function(t,n){ke(e,n,t)}))}function On(t,e,n){n=Math.min(t.j.length,n);var r=t.h?v(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),i=!1;else try{sn(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function Ln(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Dt||Nt(),Ct||(Dt(),Ct=!0),At.add(e,t),t.A=0}}function Pn(t){return!(t.g||t.u||3<=t.A)&&(t.ba++,t.u=Yt(v(t.Ma,t),jn(t,t.A)),t.A++,!0)}function Vn(t){null!=t.B&&(d.clearTimeout(t.B),t.B=null)}function qn(t){t.g=new ce(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=De(t.wa);ke(e,"RID","rpc"),ke(e,"SID",t.K),ke(e,"AID",t.V),ke(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&ke(e,"TO",t.qa),ke(e,"TYPE","xmlhttp"),Fn(t,e),t.o&&t.s&&xn(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=Re(De(e)),n.s=null,n.S=!0,me(n,t)}function Bn(t){null!=t.v&&(d.clearTimeout(t.v),t.v=null)}function Un(t,e){var n=null;if(t.g==e){Bn(t),Vn(t),t.g=null;var r=2}else{if(!Je(t.i,e))return;n=e.F,tn(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.G;var s=t.C;vt(r=Kt(),new Xt(r,n)),Rn(t)}else Ln(t);else if(3==(s=e.o)||0==s&&0<e.ca||!(1==r&&function(t,e){return!(Ye(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Yt(v(t.Na,t,e),jn(t,t.C)),t.C++,0)))}(t,e)||2==r&&Pn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Gn(t,5);break;case 4:Gn(t,10);break;case 3:Gn(t,6);break;default:Gn(t,2)}}function jn(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Gn(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=v(t.pb,t);n||(n=new xe("//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||Ce(n,"https"),Re(n)),function(t,e){const n=new Ut;if(d.Image){const r=new Image;r.onload=b(on,n,r,"TestLoadImage: loaded",!0,e),r.onerror=b(on,n,r,"TestLoadImage: error",!1,e),r.onabort=b(on,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=b(on,n,r,"TestLoadImage: timeout",!1,e),d.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Ht(2);t.H=0,t.h&&t.h.za(e),zn(t),kn(t)}function zn(t){if(t.H=0,t.ma=[],t.h){const e=en(t.i);0==e.length&&0==t.j.length||(S(t.ma,e),S(t.ma,t.j),t.i.i.length=0,_(t.j),t.j.length=0),t.h.ya()}}function Kn(t,e,n){var r=n instanceof xe?De(n):new xe(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Ae(r,r.m);else{var s=d.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new xe(null);r&&Ce(i,r),e&&(i.g=e),s&&Ae(i,s),n&&(i.l=n),r=i}return n=t.F,e=t.Da,n&&e&&ke(r,n,e),ke(r,"VER",t.ra),Fn(t,r),r}function $n(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new mn(new an({ob:!0})):new mn(t.va)).Oa(t.J),e}function Qn(){}function Wn(){if(L&&!(10<=Number($)))throw Error("Environmental error: no available transport.")}function Hn(t,e){wt.call(this),this.g=new Cn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!C(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!C(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Jn(this)}function Xn(t){ie.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Yn(){oe.call(this),this.status=1}function Jn(t){this.g=t}function Zn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function tr(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function er(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}(r=mn.prototype).Oa=function(t){this.M=t},r.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():re.g(),this.C=this.u?ee(this.u):ee(re),this.g.onreadystatechange=v(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void wn(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=d.FormData&&t instanceof d.FormData,!(0<=E(yn,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Tn(this),0<this.B&&((this.L=function(t){return L&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=v(this.ua,this)):this.A=Ft(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){wn(this,t)}},r.ua=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,vt(this,"timeout"),this.abort(8))},r.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,vt(this,"complete"),vt(this,"abort"),In(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),In(this,!0)),mn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?bn(this):this.kb())},r.kb=function(){bn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<En(this)?this.g.status:-1}catch(t){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),fn(e)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=Cn.prototype).ra=8,r.H=1,r.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new ce(this,this.l,t);let i=this.s;if(this.U&&(i?(i=tt(i),nt(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=On(this,s,e),ke(n=De(this.I),"RID",t),ke(n,"CVER",22),this.F&&ke(n,"X-HTTP-Session-Id",this.F),Fn(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(Sn(i)))+"&"+e:this.o&&xn(n,this.o,i)),Ze(this.i,s),this.bb&&ke(n,"TYPE","init"),this.P?(ke(n,"$req",e),ke(n,"SID","null"),s.aa=!0,fe(s,n,null)):fe(s,n,e),this.H=2}}else 3==this.H&&(t?Mn(this,t):0==this.j.length||Xe(this.i)||Mn(this))},r.Ma=function(){if(this.u=null,qn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Yt(v(this.jb,this),t)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ht(10),Nn(this),qn(this))},r.ib=function(){null!=this.v&&(this.v=null,Nn(this),Pn(this),Ht(19))},r.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Ht(2)):(this.l.info("Failed to ping google.com"),Ht(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=Qn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},Wn.prototype.g=function(t,e){return new Hn(t,e)},I(Hn,wt),Hn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Ht(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Kn(t,null,t.Y),Rn(t)},Hn.prototype.close=function(){An(this.g)},Hn.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=It(t),t=n);e.j.push(new Qe(e.fb++,t)),3==e.H&&Rn(e)},Hn.prototype.N=function(){this.g.h=null,delete this.j,An(this.g),delete this.g,Hn.$.N.call(this)},I(Xn,ie),I(Yn,oe),I(Jn,Qn),Jn.prototype.Ba=function(){vt(this.g,"a")},Jn.prototype.Aa=function(t){vt(this.g,new Xn(t))},Jn.prototype.za=function(t){vt(this.g,new Yn)},Jn.prototype.ya=function(){vt(this.g,"b")},I(Zn,(function(){this.blockSize=-1})),Zn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Zn.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(0==s)for(;i<=n;)tr(this,t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(r[s++]=t.charCodeAt(i++),s==this.blockSize){tr(this,r),s=0;break}}else for(;i<e;)if(r[s++]=t[i++],s==this.blockSize){tr(this,r),s=0;break}}this.h=s,this.i+=e},Zn.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var nr={};function rr(t){return-128<=t&&128>t?function(t,e){var n=nr;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(t){return new er([0|t],0>t?-1:0)})):new er([0|t],0>t?-1:0)}function sr(t){if(isNaN(t)||!isFinite(t))return or;if(0>t)return lr(sr(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=ir;return new er(e,0)}var ir=4294967296,or=rr(0),ar=rr(1),cr=rr(16777216);function ur(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function hr(t){return-1==t.h}function lr(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new er(n,~t.h).add(ar)}function dr(t,e){return t.add(lr(e))}function fr(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function mr(t,e){this.g=t,this.h=e}function gr(t,e){if(ur(e))throw Error("division by zero");if(ur(t))return new mr(or,or);if(hr(t))return e=gr(lr(t),e),new mr(lr(e.g),lr(e.h));if(hr(e))return e=gr(t,lr(e)),new mr(lr(e.g),e.h);if(30<t.g.length){if(hr(t)||hr(e))throw Error("slowDivide_ only works with positive integers.");for(var n=ar,r=e;0>=r.X(t);)n=pr(n),r=pr(r);var s=yr(n,1),i=yr(r,1);for(r=yr(r,2),n=yr(n,2);!ur(r);){var o=i.add(r);0>=o.X(t)&&(s=s.add(n),i=o),r=yr(r,1),n=yr(n,1)}return e=dr(t,s.R(e)),new mr(s,e)}for(s=or;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=sr(n)).R(e);hr(o)||0<o.X(t);)o=(i=sr(n-=r)).R(e);ur(i)&&(i=ar),s=s.add(i),t=dr(t,o)}return new mr(s,t)}function pr(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new er(n,t.h)}function yr(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,s=[],i=0;i<r;i++)s[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new er(s,t.h)}(r=er.prototype).ea=function(){if(hr(this))return-lr(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:ir+r)*e,e*=ir}return t},r.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(ur(this))return"0";if(hr(this))return"-"+lr(this).toString(t);for(var e=sr(Math.pow(t,6)),n=this,r="";;){var s=gr(n,e).g,i=((0<(n=dr(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(ur(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},r.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},r.X=function(t){return hr(t=dr(this,t))?-1:ur(t)?0:1},r.abs=function(){return hr(this)?lr(this):this},r.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,s=0;s<=e;s++){var i=r+(65535&this.D(s))+(65535&t.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new er(n,-2147483648&n[n.length-1]?-1:0)},r.R=function(t){if(ur(this)||ur(t))return or;if(hr(this))return hr(t)?lr(this).R(lr(t)):lr(lr(this).R(t));if(hr(t))return lr(this.R(lr(t)));if(0>this.X(cr)&&0>t.X(cr))return sr(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<t.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=t.D(s)>>>16,c=65535&t.D(s);n[2*r+2*s]+=o*c,fr(n,2*r+2*s),n[2*r+2*s+1]+=i*c,fr(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,fr(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,fr(n,2*r+2*s+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new er(n,0)},r.gb=function(t){return gr(this,t).h},r.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new er(n,this.h&t.h)},r.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new er(n,this.h|t.h)},r.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new er(n,this.h^t.h)},Wn.prototype.createWebChannel=Wn.prototype.g,Hn.prototype.send=Hn.prototype.u,Hn.prototype.open=Hn.prototype.m,Hn.prototype.close=Hn.prototype.close,Jt.NO_ERROR=0,Jt.TIMEOUT=8,Jt.HTTP_ERROR=6,Zt.COMPLETE="complete",ne.EventType=se,se.OPEN="a",se.CLOSE="b",se.ERROR="c",se.MESSAGE="d",wt.prototype.listen=wt.prototype.O,mn.prototype.listenOnce=mn.prototype.P,mn.prototype.getLastError=mn.prototype.Sa,mn.prototype.getLastErrorCode=mn.prototype.Ia,mn.prototype.getStatus=mn.prototype.da,mn.prototype.getResponseJson=mn.prototype.Wa,mn.prototype.getResponseText=mn.prototype.ja,mn.prototype.send=mn.prototype.ha,mn.prototype.setWithCredentials=mn.prototype.Oa,Zn.prototype.digest=Zn.prototype.l,Zn.prototype.reset=Zn.prototype.reset,Zn.prototype.update=Zn.prototype.j,er.prototype.add=er.prototype.add,er.prototype.multiply=er.prototype.R,er.prototype.modulo=er.prototype.gb,er.prototype.compare=er.prototype.X,er.prototype.toNumber=er.prototype.ea,er.prototype.toString=er.prototype.toString,er.prototype.getBits=er.prototype.D,er.fromNumber=sr,er.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return lr(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=sr(Math.pow(n,8)),s=or,i=0;i<e.length;i+=8){var o=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+o),n);8>o?(o=sr(Math.pow(n,o)),s=s.R(o).add(sr(a))):s=(s=s.R(r)).add(sr(a))}return s};var wr=h.createWebChannelTransport=function(){return new Wn},vr=h.getStatEventTarget=function(){return Kt()},br=h.ErrorCode=Jt,Ir=h.EventType=Zt,Tr=h.Event=Gt,Er=h.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},_r=h.FetchXmlHttpFactory=an,Sr=h.WebChannel=ne,xr=h.XhrIo=mn,Dr=h.Md5=Zn,Cr=h.Integer=er;const Ar="@firebase/firestore";class Nr{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Nr.UNAUTHENTICATED=new Nr(null),Nr.GOOGLE_CREDENTIALS=new Nr("google-credentials-uid"),Nr.FIRST_PARTY=new Nr("first-party-uid"),Nr.MOCK_USER=new Nr("mock-user");let kr="9.23.0";const Rr=new a.Yd("@firebase/firestore");function Mr(){return Rr.logLevel}function Fr(t,...e){if(Rr.logLevel<=a.in.DEBUG){const n=e.map(Pr);Rr.debug(`Firestore (${kr}): ${t}`,...n)}}function Or(t,...e){if(Rr.logLevel<=a.in.ERROR){const n=e.map(Pr);Rr.error(`Firestore (${kr}): ${t}`,...n)}}function Lr(t,...e){if(Rr.logLevel<=a.in.WARN){const n=e.map(Pr);Rr.warn(`Firestore (${kr}): ${t}`,...n)}}function Pr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Vr(t="Unexpected state"){const e=`FIRESTORE (${kr}) INTERNAL ASSERTION FAILED: `+t;throw Or(e),new Error(e)}function qr(t,e){t||Vr()}function Br(t,e){return t}const Ur={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class jr extends c.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Gr{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class zr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Kr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Nr.UNAUTHENTICATED)))}shutdown(){}}class $r{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Qr{constructor(t){this.t=t,this.currentUser=Nr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new Gr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Gr,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Fr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Fr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Gr)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Fr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(qr("string"==typeof e.accessToken),new zr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return qr(null===t||"string"==typeof t),new Nr(t)}}class Wr{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=Nr.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const t=this.p();return t&&this.g.set("Authorization",t),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Hr{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new Wr(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(Nr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Xr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yr{constructor(t){this.I=t,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,e){const n=t=>{null!=t.error&&Fr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.T;return this.T=t.token,Fr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Fr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.I.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.I.getImmediate({optional:!0});t?r(t):Fr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(qr("string"==typeof t.token),this.T=t.token,new Xr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Jr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Zr{static A(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=Jr(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%62))}return n}}function ts(t,e){return t<e?-1:t>e?1:0}function es(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function ns(t){return t+"\0"}class rs{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new jr(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new jr(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new jr(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new jr(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return rs.fromMillis(Date.now())}static fromDate(t){return rs.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new rs(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ts(this.nanoseconds,t.nanoseconds):ts(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ss{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ss(t)}static min(){return new ss(new rs(0,0))}static max(){return new ss(new rs(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class is{constructor(t,e,n){void 0===e?e=0:e>t.length&&Vr(),void 0===n?n=t.length-e:n>t.length-e&&Vr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===is.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof is?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class os extends is{construct(t,e,n){return new os(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new jr(Ur.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new os(e)}static emptyPath(){return new os([])}}const as=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class cs extends is{construct(t,e,n){return new cs(t,e,n)}static isValidIdentifier(t){return as.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),cs.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new cs(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new jr(Ur.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new jr(Ur.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new jr(Ur.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new jr(Ur.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new cs(e)}static emptyPath(){return new cs([])}}class us{constructor(t){this.path=t}static fromPath(t){return new us(os.fromString(t))}static fromName(t){return new us(os.fromString(t).popFirst(5))}static empty(){return new us(os.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===os.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return os.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new us(new os(t.slice()))}}class hs{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}function ls(t){return t.fields.find((t=>2===t.kind))}function ds(t){return t.fields.filter((t=>2!==t.kind))}hs.UNKNOWN_ID=-1;class fs{constructor(t,e){this.fieldPath=t,this.kind=e}}class ms{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new ms(0,ys.min())}}function gs(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=ss.fromTimestamp(1e9===r?new rs(n+1,0):new rs(n,r));return new ys(s,us.empty(),e)}function ps(t){return new ys(t.readTime,t.key,-1)}class ys{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ys(ss.min(),us.empty(),-1)}static max(){return new ys(ss.max(),us.empty(),-1)}}function ws(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=us.comparator(t.documentKey,e.documentKey),0!==n?n:ts(t.largestBatchId,e.largestBatchId))}const vs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bs{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Is(t){if(t.code!==Ur.FAILED_PRECONDITION||t.message!==vs)throw t;Fr("LocalStore","Unexpectedly lost primary lease")}class Ts{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Vr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ts(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Ts?e:Ts.resolve(e)}catch(t){return Ts.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Ts.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Ts.reject(e)}static resolve(t){return new Ts(((e,n)=>{e(t)}))}static reject(t){return new Ts(((e,n)=>{n(t)}))}static waitFor(t){return new Ts(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Ts.resolve(!1);for(const n of t)e=e.next((t=>t?Ts.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Ts(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new Ts(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class Es{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.v=new Gr,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{e.error?this.v.reject(new xs(t,e.error)):this.v.resolve()},this.transaction.onerror=e=>{const n=ks(e.target.error);this.v.reject(new xs(t,n))}}static open(t,e,n,r){try{return new Es(e,t.transaction(r,n))}catch(t){throw new xs(e,t)}}get R(){return this.v.promise}abort(t){t&&this.v.reject(t),this.aborted||(Fr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Cs(e)}}class _s{constructor(t,e,n){this.name=t,this.version=e,this.V=n,12.2===_s.S((0,c.z$)())&&Or("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Fr("SimpleDb","Removing database:",t),As(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!(0,c.hl)())return!1;if(_s.C())return!0;const t=(0,c.z$)(),e=_s.S(t),n=0<e&&e<10,r=_s.N(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.k)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(t){return this.db||(Fr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new xs(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new jr(Ur.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new jr(Ur.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new xs(t,r))},r.onupgradeneeded=t=>{Fr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.V.O(e,r.transaction,t.oldVersion,this.version).next((()=>{Fr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=t=>this.F(t)),this.db}B(t){this.F=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.$(t);const e=Es.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.P(),t))).catch((t=>(e.abort(t),Ts.reject(t)))).toPromise();return i.catch((()=>{})),await e.R,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(Fr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ss{constructor(t){this.L=t,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(t){this.L=t}done(){this.q=!0}G(t){this.U=t}delete(){return As(this.L.delete())}}class xs extends jr{constructor(t,e){super(Ur.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Ds(t){return"IndexedDbTransactionError"===t.name}class Cs{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Fr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Fr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),As(n)}add(t){return Fr("SimpleDb","ADD",this.store.name,t,t),As(this.store.add(t))}get(t){return As(this.store.get(t)).next((e=>(void 0===e&&(e=null),Fr("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Fr("SimpleDb","DELETE",this.store.name,t),As(this.store.delete(t))}count(){return Fr("SimpleDb","COUNT",this.store.name),As(this.store.count())}j(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.W(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new Ts(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}H(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new Ts(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}J(t,e){Fr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.Y=!1;const r=this.cursor(n);return this.W(r,((t,e,n)=>n.delete()))}X(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.W(r,e)}Z(t){const e=this.cursor({});return new Ts(((n,r)=>{e.onerror=t=>{const e=ks(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}W(t,e){const n=[];return new Ts(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new Ss(s),o=e(s.primaryKey,s.value,i);if(o instanceof Ts){const t=o.catch((t=>(i.done(),Ts.reject(t))));n.push(t)}i.isDone?r():null===i.K?s.continue():s.continue(i.K)}})).next((()=>Ts.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Y?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function As(t){return new Ts(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=ks(t.target.error);n(e)}}))}let Ns=!1;function ks(t){const e=_s.S((0,c.z$)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new jr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ns||(Ns=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Rs{constructor(t,e){this.asyncQueue=t,this.tt=e,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(t){Fr("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{Fr("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(t){Ds(t)?Fr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await Is(t)}await this.et(6e4)}))}}class Ms{constructor(t,e){this.localStore=t,this.persistence=e}async nt(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.st(e,t)))}st(t,e){const n=new Set;let r=e,s=!0;return Ts.doWhile((()=>!0===s&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((e=>{if(null!==e&&!n.has(e))return Fr("IndexBackiller",`Processing collection: ${e}`),this.it(t,e,r).next((t=>{r-=t,n.add(e)}));s=!1})))).next((()=>e-r))}it(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((r=>this.localStore.localDocuments.getNextDocuments(t,e,r,n).next((n=>{const s=n.changes;return this.localStore.indexManager.updateIndexEntries(t,s).next((()=>this.rt(r,n))).next((n=>(Fr("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(t,e,n)))).next((()=>s.size))}))))}rt(t,e){let n=t;return e.changes.forEach(((t,e)=>{const r=ps(e);ws(r,n)>0&&(n=r)})),new ys(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class Fs{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ot(t),this.ut=t=>e.writeSequenceNumber(t))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}function Os(t){return null==t}function Ls(t){return 0===t&&1/t==-1/0}function Ps(t){return"number"==typeof t&&Number.isInteger(t)&&!Ls(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function Vs(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Bs(e)),e=qs(t.get(n),e);return Bs(e)}function qs(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Bs(t){return t+""}function Us(t){const e=t.length;if(qr(e>=2),2===e)return qr(""===t.charAt(0)&&""===t.charAt(1)),os.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const e=t.indexOf("",i);switch((e<0||e>n)&&Vr(),t.charAt(e+1)){case"":const n=t.substring(i,e);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=t.substring(i,e),s+="\0";break;case"":s+=t.substring(i,e+1);break;default:Vr()}i=e+2}return new os(r)}Fs.ct=-1;const js=["userId","batchId"];function Gs(t,e){return[t,Vs(e)]}function zs(t,e,n){return[t,Vs(e),n]}const Ks={},$s=["prefixPath","collectionGroup","readTime","documentId"],Qs=["prefixPath","collectionGroup","documentId"],Ws=["collectionGroup","readTime","prefixPath","documentId"],Hs=["canonicalId","targetId"],Xs=["targetId","path"],Ys=["path","targetId"],Js=["collectionId","parent"],Zs=["indexId","uid"],ti=["uid","sequenceNumber"],ei=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ni=["indexId","uid","orderedDocumentKey"],ri=["userId","collectionPath","documentId"],si=["userId","collectionPath","largestBatchId"],ii=["userId","collectionGroup","largestBatchId"],oi=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ai=[...oi,"documentOverlays"],ci=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ui=ci,hi=[...ui,"indexConfiguration","indexState","indexEntries"];class li extends bs{constructor(t,e){super(),this.ht=t,this.currentSequenceNumber=e}}function di(t,e){const n=Br(t);return _s.M(n.ht,e)}function fi(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function mi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function gi(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class pi{constructor(t,e){this.comparator=t,this.root=e||wi.EMPTY}insert(t,e){return new pi(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,wi.BLACK,null,null))}remove(t){return new pi(this.comparator,this.root.remove(t,this.comparator).copy(null,null,wi.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new yi(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new yi(this.root,t,this.comparator,!1)}getReverseIterator(){return new yi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new yi(this.root,t,this.comparator,!0)}}class yi{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class wi{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:wi.RED,this.left=null!=r?r:wi.EMPTY,this.right=null!=s?s:wi.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new wi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return wi.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return wi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,wi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,wi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Vr();if(this.right.isRed())throw Vr();const t=this.left.check();if(t!==this.right.check())throw Vr();return t+(this.isRed()?0:1)}}wi.EMPTY=null,wi.RED=!0,wi.BLACK=!1,wi.EMPTY=new class{constructor(){this.size=0}get key(){throw Vr()}get value(){throw Vr()}get color(){throw Vr()}get left(){throw Vr()}get right(){throw Vr()}copy(t,e,n,r,s){return this}insert(t,e,n){return new wi(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class vi{constructor(t){this.comparator=t,this.data=new pi(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new bi(this.data.getIterator())}getIteratorFrom(t){return new bi(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof vi))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new vi(this.comparator);return e.data=t,e}}class bi{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ii(t){return t.hasNext()?t.getNext():void 0}class Ti{constructor(t){this.fields=t,t.sort(cs.comparator)}static empty(){return new Ti([])}unionWith(t){let e=new vi(cs.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ti(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return es(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Ei extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class _i{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ei("Invalid base64 string: "+t):t}}(t);return new _i(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new _i(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ts(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}_i.EMPTY_BYTE_STRING=new _i("");const Si=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xi(t){if(qr(!!t),"string"==typeof t){let e=0;const n=Si.exec(t);if(qr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Di(t.seconds),nanos:Di(t.nanos)}}function Di(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ci(t){return"string"==typeof t?_i.fromBase64String(t):_i.fromUint8Array(t)}function Ai(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ni(t){const e=t.mapValue.fields.__previous_value__;return Ai(e)?Ni(e):e}function ki(t){const e=xi(t.mapValue.fields.__local_write_time__.timestampValue);return new rs(e.seconds,e.nanos)}class Ri{constructor(t,e,n,r,s,i,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Mi{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Mi("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Mi&&t.projectId===this.projectId&&t.database===this.database}}const Fi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Oi={nullValue:"NULL_VALUE"};function Li(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ai(t)?4:Xi(t)?9007199254740991:10:Vr()}function Pi(t,e){if(t===e)return!0;const n=Li(t);if(n!==Li(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ki(t).isEqual(ki(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=xi(t.timestampValue),r=xi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ci(t.bytesValue).isEqual(Ci(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Di(t.geoPointValue.latitude)===Di(e.geoPointValue.latitude)&&Di(t.geoPointValue.longitude)===Di(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Di(t.integerValue)===Di(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Di(t.doubleValue),r=Di(e.doubleValue);return n===r?Ls(n)===Ls(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return es(t.arrayValue.values||[],e.arrayValue.values||[],Pi);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(fi(n)!==fi(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Pi(n[t],r[t])))return!1;return!0}(t,e);default:return Vr()}}function Vi(t,e){return void 0!==(t.values||[]).find((t=>Pi(t,e)))}function qi(t,e){if(t===e)return 0;const n=Li(t),r=Li(e);if(n!==r)return ts(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ts(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Di(t.integerValue||t.doubleValue),r=Di(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Bi(t.timestampValue,e.timestampValue);case 4:return Bi(ki(t),ki(e));case 5:return ts(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ci(t),r=Ci(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=ts(n[t],r[t]);if(0!==e)return e}return ts(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ts(Di(t.latitude),Di(e.latitude));return 0!==n?n:ts(Di(t.longitude),Di(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=qi(n[t],r[t]);if(e)return e}return ts(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Fi.mapValue&&e===Fi.mapValue)return 0;if(t===Fi.mapValue)return 1;if(e===Fi.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=ts(r[t],i[t]);if(0!==e)return e;const o=qi(n[r[t]],s[i[t]]);if(0!==o)return o}return ts(r.length,i.length)}(t.mapValue,e.mapValue);default:throw Vr()}}function Bi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ts(t,e);const n=xi(t),r=xi(e),s=ts(n.seconds,r.seconds);return 0!==s?s:ts(n.nanos,r.nanos)}function Ui(t){return ji(t)}function ji(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=xi(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ci(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,us.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=ji(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${ji(t.fields[s])}`;return n+"}"}(t.mapValue):Vr();var e,n}function Gi(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function zi(t){return!!t&&"integerValue"in t}function Ki(t){return!!t&&"arrayValue"in t}function $i(t){return!!t&&"nullValue"in t}function Qi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Wi(t){return!!t&&"mapValue"in t}function Hi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return mi(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Hi(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Hi(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Xi(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function Yi(t){return"nullValue"in t?Oi:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Gi(Mi.empty(),us.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:Vr()}function Ji(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Gi(Mi.empty(),us.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?Fi:Vr()}function Zi(t,e){const n=qi(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function to(t,e){const n=qi(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}class eo{constructor(t){this.value=t}static empty(){return new eo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Wi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Hi(e)}setAll(t){let e=cs.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=Hi(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());Wi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Pi(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Wi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){mi(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new eo(Hi(this.value))}}function no(t){const e=[];return mi(t.fields,((t,n)=>{const r=new cs([t]);if(Wi(n)){const t=no(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new Ti(e)}class ro{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new ro(t,0,ss.min(),ss.min(),ss.min(),eo.empty(),0)}static newFoundDocument(t,e,n,r){return new ro(t,1,e,ss.min(),n,r,0)}static newNoDocument(t,e){return new ro(t,2,e,ss.min(),ss.min(),eo.empty(),0)}static newUnknownDocument(t,e){return new ro(t,3,e,ss.min(),ss.min(),eo.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ss.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=eo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=eo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ss.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof ro&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ro(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class so{constructor(t,e){this.position=t,this.inclusive=e}}function io(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?us.comparator(us.fromName(o.referenceValue),n.key):qi(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function oo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Pi(t.position[n],e.position[n]))return!1;return!0}class ao{constructor(t,e="asc"){this.field=t,this.dir=e}}function co(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class uo{}class ho extends uo{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Io(t,e,n):"array-contains"===e?new So(t,n):"in"===e?new xo(t,n):"not-in"===e?new Do(t,n):"array-contains-any"===e?new Co(t,n):new ho(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new To(t,n):new Eo(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(qi(e,this.value)):null!==e&&Li(this.value)===Li(e)&&this.matchesComparison(qi(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Vr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class lo extends uo{constructor(t,e){super(),this.filters=t,this.op=e,this.lt=null}static create(t,e){return new lo(t,e)}matches(t){return fo(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.ft((t=>t.isInequality()));return null!==t?t.field:null}ft(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function fo(t){return"and"===t.op}function mo(t){return"or"===t.op}function go(t){return po(t)&&fo(t)}function po(t){for(const e of t.filters)if(e instanceof lo)return!1;return!0}function yo(t){if(t instanceof ho)return t.field.canonicalString()+t.op.toString()+Ui(t.value);if(go(t))return t.filters.map((t=>yo(t))).join(",");{const e=t.filters.map((t=>yo(t))).join(",");return`${t.op}(${e})`}}function wo(t,e){return t instanceof ho?function(t,e){return e instanceof ho&&t.op===e.op&&t.field.isEqual(e.field)&&Pi(t.value,e.value)}(t,e):t instanceof lo?function(t,e){return e instanceof lo&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&wo(n,e.filters[r])),!0)}(t,e):void Vr()}function vo(t,e){const n=t.filters.concat(e);return lo.create(n,t.op)}function bo(t){return t instanceof ho?function(t){return`${t.field.canonicalString()} ${t.op} ${Ui(t.value)}`}(t):t instanceof lo?function(t){return t.op.toString()+" {"+t.getFilters().map(bo).join(" ,")+"}"}(t):"Filter"}class Io extends ho{constructor(t,e,n){super(t,e,n),this.key=us.fromName(n.referenceValue)}matches(t){const e=us.comparator(t.key,this.key);return this.matchesComparison(e)}}class To extends ho{constructor(t,e){super(t,"in",e),this.keys=_o("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Eo extends ho{constructor(t,e){super(t,"not-in",e),this.keys=_o("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function _o(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>us.fromName(t.referenceValue)))}class So extends ho{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ki(e)&&Vi(e.arrayValue,this.value)}}class xo extends ho{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Vi(this.value.arrayValue,e)}}class Do extends ho{constructor(t,e){super(t,"not-in",e)}matches(t){if(Vi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Vi(this.value.arrayValue,e)}}class Co extends ho{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ki(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Vi(this.value.arrayValue,t)))}}class Ao{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.dt=null}}function No(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Ao(t,e,n,r,s,i,o)}function ko(t){const e=Br(t);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>yo(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Os(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Ui(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Ui(t))).join(",")),e.dt=t}return e.dt}function Ro(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!co(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!wo(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!oo(t.startAt,e.startAt)&&oo(t.endAt,e.endAt)}function Mo(t){return us.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Fo(t,e){return t.filters.filter((t=>t instanceof ho&&t.field.isEqual(e)))}function Oo(t,e,n){let r=Oi,s=!0;for(const n of Fo(t,e)){let t=Oi,e=!0;switch(n.op){case"<":case"<=":t=Yi(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=Oi}Zi({value:r,inclusive:s},{value:t,inclusive:e})<0&&(r=t,s=e)}if(null!==n)for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const t=n.position[i];Zi({value:r,inclusive:s},{value:t,inclusive:n.inclusive})<0&&(r=t,s=n.inclusive);break}return{value:r,inclusive:s}}function Lo(t,e,n){let r=Fi,s=!0;for(const n of Fo(t,e)){let t=Fi,e=!0;switch(n.op){case">=":case">":t=Ji(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=Fi}to({value:r,inclusive:s},{value:t,inclusive:e})>0&&(r=t,s=e)}if(null!==n)for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const t=n.position[i];to({value:r,inclusive:s},{value:t,inclusive:n.inclusive})>0&&(r=t,s=n.inclusive);break}return{value:r,inclusive:s}}class Po{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Vo(t,e,n,r,s,i,o,a){return new Po(t,e,n,r,s,i,o,a)}function qo(t){return new Po(t)}function Bo(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Uo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function jo(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Go(t){return null!==t.collectionGroup}function zo(t){const e=Br(t);if(null===e.wt){e.wt=[];const t=jo(e),n=Uo(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new ao(t)),e.wt.push(new ao(cs.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new ao(cs.keyField(),t))}}}return e.wt}function Ko(t){const e=Br(t);if(!e._t)if("F"===e.limitType)e._t=No(e.path,e.collectionGroup,zo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of zo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new ao(n.field,e))}const n=e.endAt?new so(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new so(e.startAt.position,e.startAt.inclusive):null;e._t=No(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e._t}function $o(t,e){e.getFirstInequalityField(),jo(t);const n=t.filters.concat([e]);return new Po(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Qo(t,e,n){return new Po(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Wo(t,e){return Ro(Ko(t),Ko(e))&&t.limitType===e.limitType}function Ho(t){return`${ko(Ko(t))}|lt:${t.limitType}`}function Xo(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>bo(t))).join(", ")}]`),Os(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Ui(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Ui(t))).join(",")),`Target(${e})`}(Ko(t))}; limitType=${t.limitType})`}function Yo(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):us.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of zo(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=io(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,zo(t),e))&&!(t.endAt&&!function(t,e,n){const r=io(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,zo(t),e))}(t,e)}function Jo(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Zo(t){return(e,n)=>{let r=!1;for(const s of zo(t)){const t=ta(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function ta(t,e,n){const r=t.field.isKeyField()?us.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?qi(r,s):Vr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Vr()}}class ea{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){mi(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return gi(this.inner)}size(){return this.innerSize}}const na=new pi(us.comparator);function ra(){return na}const sa=new pi(us.comparator);function ia(...t){let e=sa;for(const n of t)e=e.insert(n.key,n);return e}function oa(t){let e=sa;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function aa(){return ua()}function ca(){return ua()}function ua(){return new ea((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ha=new pi(us.comparator),la=new vi(us.comparator);function da(...t){let e=la;for(const n of t)e=e.add(n);return e}const fa=new vi(ts);function ma(){return fa}function ga(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ls(e)?"-0":e}}function pa(t){return{integerValue:""+t}}function ya(t,e){return Ps(e)?pa(e):ga(t,e)}class wa{constructor(){this._=void 0}}function va(t,e,n){return t instanceof Ta?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ai(e)&&(e=Ni(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ea?_a(t,e):t instanceof Sa?xa(t,e):function(t,e){const n=Ia(t,e),r=Ca(n)+Ca(t.gt);return zi(n)&&zi(t.gt)?pa(r):ga(t.serializer,r)}(t,e)}function ba(t,e,n){return t instanceof Ea?_a(t,e):t instanceof Sa?xa(t,e):n}function Ia(t,e){return t instanceof Da?zi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Ta extends wa{}class Ea extends wa{constructor(t){super(),this.elements=t}}function _a(t,e){const n=Aa(e);for(const e of t.elements)n.some((t=>Pi(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Sa extends wa{constructor(t){super(),this.elements=t}}function xa(t,e){let n=Aa(e);for(const e of t.elements)n=n.filter((t=>!Pi(t,e)));return{arrayValue:{values:n}}}class Da extends wa{constructor(t,e){super(),this.serializer=t,this.gt=e}}function Ca(t){return Di(t.integerValue||t.doubleValue)}function Aa(t){return Ki(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Na{constructor(t,e){this.field=t,this.transform=e}}class ka{constructor(t,e){this.version=t,this.transformResults=e}}class Ra{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ra}static exists(t){return new Ra(void 0,t)}static updateTime(t){return new Ra(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ma(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Fa{}function Oa(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Ka(t.key,Ra.none()):new Ba(t.key,t.data,Ra.none());{const n=t.data,r=eo.empty();let s=new vi(cs.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new Ua(t.key,r,new Ti(s.toArray()),Ra.none())}}function La(t,e,n){t instanceof Ba?function(t,e,n){const r=t.value.clone(),s=Ga(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Ua?function(t,e,n){if(!Ma(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Ga(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(ja(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Pa(t,e,n,r){return t instanceof Ba?function(t,e,n,r){if(!Ma(t.precondition,e))return n;const s=t.value.clone(),i=za(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ua?function(t,e,n,r){if(!Ma(t.precondition,e))return n;const s=za(t.fieldTransforms,r,e),i=e.data;return i.setAll(ja(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Ma(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Va(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Ia(r.transform,t||null);null!=s&&(null===n&&(n=eo.empty()),n.set(r.field,s))}return n||null}function qa(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&es(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ea&&e instanceof Ea||t instanceof Sa&&e instanceof Sa?es(t.elements,e.elements,Pi):t instanceof Da&&e instanceof Da?Pi(t.gt,e.gt):t instanceof Ta&&e instanceof Ta}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ba extends Fa{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ua extends Fa{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function ja(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Ga(t,e,n){const r=new Map;qr(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,ba(o,a,n[s]))}return r}function za(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,va(t,i,e))}return r}class Ka extends Fa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $a extends Fa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Qa{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&La(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Pa(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Pa(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ca();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=Oa(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(ss.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),da())}isEqual(t){return this.batchId===t.batchId&&es(this.mutations,t.mutations,((t,e)=>qa(t,e)))&&es(this.baseMutations,t.baseMutations,((t,e)=>qa(t,e)))}}class Wa{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){qr(t.mutations.length===n.length);let r=ha;const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new Wa(t,e,n,r)}}class Ha{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Xa{constructor(t,e){this.count=t,this.unchangedNames=e}}var Ya,Ja;function Za(t){switch(t){default:return Vr();case Ur.CANCELLED:case Ur.UNKNOWN:case Ur.DEADLINE_EXCEEDED:case Ur.RESOURCE_EXHAUSTED:case Ur.INTERNAL:case Ur.UNAVAILABLE:case Ur.UNAUTHENTICATED:return!1;case Ur.INVALID_ARGUMENT:case Ur.NOT_FOUND:case Ur.ALREADY_EXISTS:case Ur.PERMISSION_DENIED:case Ur.FAILED_PRECONDITION:case Ur.ABORTED:case Ur.OUT_OF_RANGE:case Ur.UNIMPLEMENTED:case Ur.DATA_LOSS:return!0}}function tc(t){if(void 0===t)return Or("GRPC error has no .code"),Ur.UNKNOWN;switch(t){case Ya.OK:return Ur.OK;case Ya.CANCELLED:return Ur.CANCELLED;case Ya.UNKNOWN:return Ur.UNKNOWN;case Ya.DEADLINE_EXCEEDED:return Ur.DEADLINE_EXCEEDED;case Ya.RESOURCE_EXHAUSTED:return Ur.RESOURCE_EXHAUSTED;case Ya.INTERNAL:return Ur.INTERNAL;case Ya.UNAVAILABLE:return Ur.UNAVAILABLE;case Ya.UNAUTHENTICATED:return Ur.UNAUTHENTICATED;case Ya.INVALID_ARGUMENT:return Ur.INVALID_ARGUMENT;case Ya.NOT_FOUND:return Ur.NOT_FOUND;case Ya.ALREADY_EXISTS:return Ur.ALREADY_EXISTS;case Ya.PERMISSION_DENIED:return Ur.PERMISSION_DENIED;case Ya.FAILED_PRECONDITION:return Ur.FAILED_PRECONDITION;case Ya.ABORTED:return Ur.ABORTED;case Ya.OUT_OF_RANGE:return Ur.OUT_OF_RANGE;case Ya.UNIMPLEMENTED:return Ur.UNIMPLEMENTED;case Ya.DATA_LOSS:return Ur.DATA_LOSS;default:return Vr()}}(Ja=Ya||(Ya={}))[Ja.OK=0]="OK",Ja[Ja.CANCELLED=1]="CANCELLED",Ja[Ja.UNKNOWN=2]="UNKNOWN",Ja[Ja.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ja[Ja.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ja[Ja.NOT_FOUND=5]="NOT_FOUND",Ja[Ja.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ja[Ja.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ja[Ja.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ja[Ja.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ja[Ja.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ja[Ja.ABORTED=10]="ABORTED",Ja[Ja.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ja[Ja.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ja[Ja.INTERNAL=13]="INTERNAL",Ja[Ja.UNAVAILABLE=14]="UNAVAILABLE",Ja[Ja.DATA_LOSS=15]="DATA_LOSS";class ec{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return nc}static getOrCreateInstance(){return null===nc&&(nc=new ec),nc}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let nc=null;function rc(){return new TextEncoder}const sc=new Cr([4294967295,4294967295],0);function ic(t){const e=rc().encode(t),n=new Dr;return n.update(e),new Uint8Array(n.digest())}function oc(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Cr([n,r],0),new Cr([s,i],0)]}class ac{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new cc(`Invalid padding: ${e}`);if(n<0)throw new cc(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new cc(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new cc(`Invalid padding when bitmap length is 0: ${e}`);this.It=8*t.length-e,this.Tt=Cr.fromNumber(this.It)}Et(t,e,n){let r=t.add(e.multiply(Cr.fromNumber(n)));return 1===r.compare(sc)&&(r=new Cr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}vt(t){if(0===this.It)return!1;const e=ic(t),[n,r]=oc(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,r,t);if(!this.At(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new ac(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.It)return;const e=ic(t),[n,r]=oc(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,r,t);this.Rt(e)}}Rt(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class cc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class uc{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,hc.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new uc(ss.min(),r,new pi(ts),ra(),da())}}class hc{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new hc(n,e,da(),da(),da())}}class lc{constructor(t,e,n,r){this.Pt=t,this.removedTargetIds=e,this.key=n,this.bt=r}}class dc{constructor(t,e){this.targetId=t,this.Vt=e}}class fc{constructor(t,e,n=_i.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class mc{constructor(){this.St=0,this.Dt=yc(),this.Ct=_i.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(t){t.approximateByteSize()>0&&(this.Nt=!0,this.Ct=t)}Ot(){let t=da(),e=da(),n=da();return this.Dt.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Vr()}})),new hc(this.Ct,this.xt,t,e,n)}Ft(){this.Nt=!1,this.Dt=yc()}Bt(t,e){this.Nt=!0,this.Dt=this.Dt.insert(t,e)}Lt(t){this.Nt=!0,this.Dt=this.Dt.remove(t)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class gc{constructor(t){this.Gt=t,this.Qt=new Map,this.jt=ra(),this.zt=pc(),this.Wt=new pi(ts)}Ht(t){for(const e of t.Pt)t.bt&&t.bt.isFoundDocument()?this.Jt(e,t.bt):this.Yt(e,t.key,t.bt);for(const e of t.removedTargetIds)this.Yt(e,t.key,t.bt)}Xt(t){this.forEachTarget(t,(e=>{const n=this.Zt(e);switch(t.state){case 0:this.te(e)&&n.$t(t.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(t.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(e);break;case 3:this.te(e)&&(n.Kt(),n.$t(t.resumeToken));break;case 4:this.te(e)&&(this.ee(e),n.$t(t.resumeToken));break;default:Vr()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qt.forEach(((t,n)=>{this.te(n)&&e(n)}))}ne(t){var e;const n=t.targetId,r=t.Vt.count,s=this.se(n);if(s){const i=s.target;if(Mo(i))if(0===r){const t=new us(i.path);this.Yt(n,t,ro.newNoDocument(t,ss.min()))}else qr(1===r);else{const s=this.ie(n);if(s!==r){const r=this.re(t,s);if(0!==r){this.ee(n);const t=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,t)}null===(e=ec.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n){var r,s,i,o,a,c;const u={localCacheCount:e,existenceFilterCount:n.count},h=n.unchangedNames;return h&&(u.bloomFilter={applied:0===t,hashCount:null!==(r=null==h?void 0:h.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(i=null===(s=null==h?void 0:h.bits)||void 0===s?void 0:s.bitmap)||void 0===i?void 0:i.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(r,s,t.Vt))}}}}re(t,e){const{unchangedNames:n,count:r}=t.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:s="",padding:i=0},hashCount:o=0}=n;let a,c;try{a=Ci(s).toUint8Array()}catch(t){if(t instanceof Ei)return Lr("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw t}try{c=new ac(a,i,o)}catch(t){return Lr(t instanceof cc?"BloomFilter error: ":"Applying bloom filter failed: ",t),1}return 0===c.It?1:r!==e-this.oe(t.targetId,c)?2:0}oe(t,e){const n=this.Gt.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const s=this.Gt.ue(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.vt(i)||(this.Yt(t,n,null),r++)})),r}ce(t){const e=new Map;this.Qt.forEach(((n,r)=>{const s=this.se(r);if(s){if(n.current&&Mo(s.target)){const e=new us(s.target.path);null!==this.jt.get(e)||this.ae(r,e)||this.Yt(r,e,ro.newNoDocument(e,t))}n.Mt&&(e.set(r,n.Ot()),n.Ft())}}));let n=da();this.zt.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.se(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.jt.forEach(((e,n)=>n.setReadTime(t)));const r=new uc(t,e,this.Wt,this.jt,n);return this.jt=ra(),this.zt=pc(),this.Wt=new pi(ts),r}Jt(t,e){if(!this.te(t))return;const n=this.ae(t,e.key)?2:0;this.Zt(t).Bt(e.key,n),this.jt=this.jt.insert(e.key,e),this.zt=this.zt.insert(e.key,this.he(e.key).add(t))}Yt(t,e,n){if(!this.te(t))return;const r=this.Zt(t);this.ae(t,e)?r.Bt(e,1):r.Lt(e),this.zt=this.zt.insert(e,this.he(e).delete(t)),n&&(this.jt=this.jt.insert(e,n))}removeTarget(t){this.Qt.delete(t)}ie(t){const e=this.Zt(t).Ot();return this.Gt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}qt(t){this.Zt(t).qt()}Zt(t){let e=this.Qt.get(t);return e||(e=new mc,this.Qt.set(t,e)),e}he(t){let e=this.zt.get(t);return e||(e=new vi(ts),this.zt=this.zt.insert(t,e)),e}te(t){const e=null!==this.se(t);return e||Fr("WatchChangeAggregator","Detected inactive target",t),e}se(t){const e=this.Qt.get(t);return e&&e.kt?null:this.Gt.le(t)}ee(t){this.Qt.set(t,new mc),this.Gt.getRemoteKeysForTarget(t).forEach((e=>{this.Yt(t,e,null)}))}ae(t,e){return this.Gt.getRemoteKeysForTarget(t).has(e)}}function pc(){return new pi(us.comparator)}function yc(){return new pi(us.comparator)}const wc={asc:"ASCENDING",desc:"DESCENDING"},vc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},bc={and:"AND",or:"OR"};class Ic{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Tc(t,e){return t.useProto3Json||Os(e)?e:{value:e}}function Ec(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function _c(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Sc(t,e){return Ec(t,e.toTimestamp())}function xc(t){return qr(!!t),ss.fromTimestamp(function(t){const e=xi(t);return new rs(e.seconds,e.nanos)}(t))}function Dc(t,e){return function(t){return new os(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Cc(t){const e=os.fromString(t);return qr(Xc(e)),e}function Ac(t,e){return Dc(t.databaseId,e.path)}function Nc(t,e){const n=Cc(e);if(n.get(1)!==t.databaseId.projectId)throw new jr(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new jr(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new us(Fc(n))}function kc(t,e){return Dc(t.databaseId,e)}function Rc(t){const e=Cc(t);return 4===e.length?os.emptyPath():Fc(e)}function Mc(t){return new os(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Fc(t){return qr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Oc(t,e,n){return{name:Ac(t,e),fields:n.value.mapValue.fields}}function Lc(t,e,n){const r=Nc(t,e.name),s=xc(e.updateTime),i=e.createTime?xc(e.createTime):ss.min(),o=new eo({mapValue:{fields:e.fields}}),a=ro.newFoundDocument(r,s,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Pc(t,e){let n;if(e instanceof Ba)n={update:Oc(t,e.key,e.value)};else if(e instanceof Ka)n={delete:Ac(t,e.key)};else if(e instanceof Ua)n={update:Oc(t,e.key,e.data),updateMask:Hc(e.fieldMask)};else{if(!(e instanceof $a))return Vr();n={verify:Ac(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ta)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ea)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Sa)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Da)return{fieldPath:e.field.canonicalString(),increment:n.gt};throw Vr()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Sc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Vr()}(t,e.precondition)),n}function Vc(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Ra.updateTime(xc(t.updateTime)):void 0!==t.exists?Ra.exists(t.exists):Ra.none()}(e.currentDocument):Ra.none(),r=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)qr("REQUEST_TIME"===e.setToServerValue),n=new Ta;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ea(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Sa(t)}else"increment"in e?n=new Da(t,e.increment):Vr();const r=cs.fromServerFormat(e.fieldPath);return new Na(r,n)}(t,e))):[];if(e.update){e.update.name;const s=Nc(t,e.update.name),i=new eo({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Ti(e.map((t=>cs.fromServerFormat(t))))}(e.updateMask);return new Ua(s,i,t,n,r)}return new Ba(s,i,n,r)}if(e.delete){const r=Nc(t,e.delete);return new Ka(r,n)}if(e.verify){const r=Nc(t,e.verify);return new $a(r,n)}return Vr()}function qc(t,e){return{documents:[kc(t,e.path)]}}function Bc(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=kc(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=kc(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(t){if(0!==t.length)return Wc(lo.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:$c(t.field),direction:Gc(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=Tc(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Uc(t){let e=Rc(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){qr(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=jc(t);return e instanceof lo&&go(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new ao(Qc(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Os(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new so(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new so(n,e)}(n.endAt)),Vo(e,s,o,i,a,"F",c,u)}function jc(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Qc(t.unaryFilter.field);return ho.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Qc(t.unaryFilter.field);return ho.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Qc(t.unaryFilter.field);return ho.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Qc(t.unaryFilter.field);return ho.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Vr()}}(t):void 0!==t.fieldFilter?function(t){return ho.create(Qc(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Vr()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return lo.create(t.compositeFilter.filters.map((t=>jc(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Vr()}}(t.compositeFilter.op))}(t):Vr()}function Gc(t){return wc[t]}function zc(t){return vc[t]}function Kc(t){return bc[t]}function $c(t){return{fieldPath:t.canonicalString()}}function Qc(t){return cs.fromServerFormat(t.fieldPath)}function Wc(t){return t instanceof ho?function(t){if("=="===t.op){if(Qi(t.value))return{unaryFilter:{field:$c(t.field),op:"IS_NAN"}};if($i(t.value))return{unaryFilter:{field:$c(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Qi(t.value))return{unaryFilter:{field:$c(t.field),op:"IS_NOT_NAN"}};if($i(t.value))return{unaryFilter:{field:$c(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$c(t.field),op:zc(t.op),value:t.value}}}(t):t instanceof lo?function(t){const e=t.getFilters().map((t=>Wc(t)));return 1===e.length?e[0]:{compositeFilter:{op:Kc(t.op),filters:e}}}(t):Vr()}function Hc(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Xc(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Yc{constructor(t,e,n,r,s=ss.min(),i=ss.min(),o=_i.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Yc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Yc(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Yc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Yc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Jc{constructor(t){this.fe=t}}function Zc(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:tu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(t,e){return{name:Ac(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Ec(t,e.version.toTimestamp()),createTime:Ec(t,e.createTime.toTimestamp())}}(t.fe,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:eu(e.version)};else{if(!e.isUnknownDocument())return Vr();r.unknownDocument={path:n.path.toArray(),version:eu(e.version)}}return r}function tu(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function eu(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function nu(t){const e=new rs(t.seconds,t.nanoseconds);return ss.fromTimestamp(e)}function ru(t,e){const n=(e.baseMutations||[]).map((e=>Vc(t.fe,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const r=e.mutations[t+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const r=e.mutations.map((e=>Vc(t.fe,e))),s=rs.fromMillis(e.localWriteTimeMs);return new Qa(e.batchId,s,n,r)}function su(t){const e=nu(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?nu(t.lastLimboFreeSnapshotVersion):ss.min();let r;var s;return void 0!==t.query.documents?(qr(1===(s=t.query).documents.length),r=Ko(qo(Rc(s.documents[0])))):r=function(t){return Ko(Uc(t))}(t.query),new Yc(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,_i.fromBase64String(t.resumeToken))}function iu(t,e){const n=eu(e.snapshotVersion),r=eu(e.lastLimboFreeSnapshotVersion);let s;s=Mo(e.target)?qc(t.fe,e.target):Bc(t.fe,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ko(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function ou(t){const e=Uc({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Qo(e,e.limit,"L"):e}function au(t,e){return new Ha(e.largestBatchId,Vc(t.fe,e.overlayMutation))}function cu(t,e){const n=e.path.lastSegment();return[t,Vs(e.path.popLast()),n]}function uu(t,e,n,r){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:eu(r.readTime),documentKey:Vs(r.documentKey.path),largestBatchId:r.largestBatchId}}class hu{getBundleMetadata(t,e){return lu(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:nu(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return lu(t).put({bundleId:(n=e).id,createTime:eu(xc(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return du(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:ou(e.bundledQuery),readTime:nu(e.readTime)};var e}))}saveNamedQuery(t,e){return du(t).put(function(t){return{name:t.name,readTime:eu(xc(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function lu(t){return di(t,"bundles")}function du(t){return di(t,"namedQueries")}class fu{constructor(t,e){this.serializer=t,this.userId=e}static de(t,e){const n=e.uid||"";return new fu(t,n)}getOverlay(t,e){return mu(t).get(cu(this.userId,e)).next((t=>t?au(this.serializer,t):null))}getOverlays(t,e){const n=aa();return Ts.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){const r=[];return n.forEach(((n,s)=>{const i=new Ha(e,s);r.push(this.we(t,i))})),Ts.waitFor(r)}removeOverlaysForBatchId(t,e,n){const r=new Set;e.forEach((t=>r.add(Vs(t.getCollectionPath()))));const s=[];return r.forEach((e=>{const r=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);s.push(mu(t).J("collectionPathOverlayIndex",r))})),Ts.waitFor(s)}getOverlaysForCollection(t,e,n){const r=aa(),s=Vs(e),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return mu(t).j("collectionPathOverlayIndex",i).next((t=>{for(const e of t){const t=au(this.serializer,e);r.set(t.getKey(),t)}return r}))}getOverlaysForCollectionGroup(t,e,n,r){const s=aa();let i;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return mu(t).X({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=au(this.serializer,e);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((()=>s))}we(t,e){return mu(t).put(function(t,e,n){const[r,s,i]=cu(e,n.mutation.key);return{userId:e,collectionPath:s,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Pc(t.fe,n.mutation)}}(this.serializer,this.userId,e))}}function mu(t){return di(t,"documentOverlays")}class gu{constructor(){}_e(t,e){this.me(t,e),e.ge()}me(t,e){if("nullValue"in t)this.ye(e,5);else if("booleanValue"in t)this.ye(e,10),e.pe(t.booleanValue?1:0);else if("integerValue"in t)this.ye(e,15),e.pe(Di(t.integerValue));else if("doubleValue"in t){const n=Di(t.doubleValue);isNaN(n)?this.ye(e,13):(this.ye(e,15),Ls(n)?e.pe(0):e.pe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ye(e,20),"string"==typeof n?e.Ie(n):(e.Ie(`${n.seconds||""}`),e.pe(n.nanos||0))}else if("stringValue"in t)this.Te(t.stringValue,e),this.Ee(e);else if("bytesValue"in t)this.ye(e,30),e.Ae(Ci(t.bytesValue)),this.Ee(e);else if("referenceValue"in t)this.ve(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ye(e,45),e.pe(n.latitude||0),e.pe(n.longitude||0)}else"mapValue"in t?Xi(t)?this.ye(e,Number.MAX_SAFE_INTEGER):(this.Re(t.mapValue,e),this.Ee(e)):"arrayValue"in t?(this.Pe(t.arrayValue,e),this.Ee(e)):Vr()}Te(t,e){this.ye(e,25),this.be(t,e)}be(t,e){e.Ie(t)}Re(t,e){const n=t.fields||{};this.ye(e,55);for(const t of Object.keys(n))this.Te(t,e),this.me(n[t],e)}Pe(t,e){const n=t.values||[];this.ye(e,50);for(const t of n)this.me(t,e)}ve(t,e){this.ye(e,37),us.fromName(t).path.forEach((t=>{this.ye(e,60),this.be(t,e)}))}ye(t,e){t.pe(e)}Ee(t){t.pe(2)}}function pu(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function yu(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const r=pu(255&t[n]);if(e+=r,8!==r)break}return e}(t);return Math.ceil(e/8)}gu.Ve=new gu;class wu{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.De(n.value),n=e.next();this.Ce()}xe(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ne(n.value),n=e.next();this.ke()}Me(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.De(t);else if(t<2048)this.De(960|t>>>6),this.De(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.De(480|t>>>12),this.De(128|63&t>>>6),this.De(128|63&t);else{const t=e.codePointAt(0);this.De(240|t>>>18),this.De(128|63&t>>>12),this.De(128|63&t>>>6),this.De(128|63&t)}}this.Ce()}$e(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Ne(t);else if(t<2048)this.Ne(960|t>>>6),this.Ne(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Ne(480|t>>>12),this.Ne(128|63&t>>>6),this.Ne(128|63&t);else{const t=e.codePointAt(0);this.Ne(240|t>>>18),this.Ne(128|63&t>>>12),this.Ne(128|63&t>>>6),this.Ne(128|63&t)}}this.ke()}Oe(t){const e=this.Fe(t),n=yu(e);this.Be(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}Le(t){const e=this.Fe(t),n=yu(e);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(t){this.Be(t.length),this.buffer.set(t,this.position),this.position+=t.length}Qe(){return this.buffer.slice(0,this.position)}Fe(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}De(t){const e=255&t;0===e?(this.Ue(0),this.Ue(255)):255===e?(this.Ue(255),this.Ue(0)):this.Ue(e)}Ne(t){const e=255&t;0===e?(this.Ge(0),this.Ge(255)):255===e?(this.Ge(255),this.Ge(0)):this.Ge(t)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(t){this.Be(1),this.buffer[this.position++]=t}Ge(t){this.Be(1),this.buffer[this.position++]=~t}Be(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class vu{constructor(t){this.je=t}Ae(t){this.je.Se(t)}Ie(t){this.je.Me(t)}pe(t){this.je.Oe(t)}ge(){this.je.qe()}}class bu{constructor(t){this.je=t}Ae(t){this.je.xe(t)}Ie(t){this.je.$e(t)}pe(t){this.je.Le(t)}ge(){this.je.Ke()}}class Iu{constructor(){this.je=new wu,this.ze=new vu(this.je),this.We=new bu(this.je)}seed(t){this.je.seed(t)}He(t){return 0===t?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class Tu{constructor(t,e,n,r){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=r}Je(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new Tu(this.indexId,this.documentKey,this.arrayValue,n)}}function Eu(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=_u(t.arrayValue,e.arrayValue),0!==n?n:(n=_u(t.directionalValue,e.directionalValue),0!==n?n:us.comparator(t.documentKey,e.documentKey)))}function _u(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(0!==r)return r}return t.length-e.length}class Su{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ye=t.orderBy,this.Xe=[];for(const e of t.filters){const t=e;t.isInequality()?this.Ze=t:this.Xe.push(t)}}tn(t){qr(t.collectionGroup===this.collectionId);const e=ls(t);if(void 0!==e&&!this.en(e))return!1;const n=ds(t);let r=new Set,s=0,i=0;for(;s<n.length&&this.en(n[s]);++s)r=r.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){const t=n[s];if(!this.nn(this.Ze,t)||!this.sn(this.Ye[i++],t))return!1}++s}for(;s<n.length;++s){const t=n[s];if(i>=this.Ye.length||!this.sn(this.Ye[i++],t))return!1}return!0}en(t){for(const e of this.Xe)if(this.nn(e,t))return!0;return!1}nn(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}function xu(t){var e,n;if(qr(t instanceof ho||t instanceof lo),t instanceof ho){if(t instanceof xo){const r=(null===(n=null===(e=t.value.arrayValue)||void 0===e?void 0:e.values)||void 0===n?void 0:n.map((e=>ho.create(t.field,"==",e))))||[];return lo.create(r,"or")}return t}const r=t.filters.map((t=>xu(t)));return lo.create(r,t.op)}function Du(t){if(0===t.getFilters().length)return[];const e=ku(xu(t));return qr(Nu(e)),Cu(e)||Au(e)?[e]:e.getFilters()}function Cu(t){return t instanceof ho}function Au(t){return t instanceof lo&&go(t)}function Nu(t){return Cu(t)||Au(t)||function(t){if(t instanceof lo&&mo(t)){for(const e of t.getFilters())if(!Cu(e)&&!Au(e))return!1;return!0}return!1}(t)}function ku(t){if(qr(t instanceof ho||t instanceof lo),t instanceof ho)return t;if(1===t.filters.length)return ku(t.filters[0]);const e=t.filters.map((t=>ku(t)));let n=lo.create(e,t.op);return n=Fu(n),Nu(n)?n:(qr(n instanceof lo),qr(fo(n)),qr(n.filters.length>1),n.filters.reduce(((t,e)=>Ru(t,e))))}function Ru(t,e){let n;return qr(t instanceof ho||t instanceof lo),qr(e instanceof ho||e instanceof lo),n=t instanceof ho?e instanceof ho?function(t,e){return lo.create([t,e],"and")}(t,e):Mu(t,e):e instanceof ho?Mu(e,t):function(t,e){if(qr(t.filters.length>0&&e.filters.length>0),fo(t)&&fo(e))return vo(t,e.getFilters());const n=mo(t)?t:e,r=mo(t)?e:t,s=n.filters.map((t=>Ru(t,r)));return lo.create(s,"or")}(t,e),Fu(n)}function Mu(t,e){if(fo(e))return vo(e,t.getFilters());{const n=e.filters.map((e=>Ru(t,e)));return lo.create(n,"or")}}function Fu(t){if(qr(t instanceof ho||t instanceof lo),t instanceof ho)return t;const e=t.getFilters();if(1===e.length)return Fu(e[0]);if(po(t))return t;const n=e.map((t=>Fu(t))),r=[];return n.forEach((e=>{e instanceof ho?r.push(e):e instanceof lo&&(e.op===t.op?r.push(...e.filters):r.push(e))})),1===r.length?r[0]:lo.create(r,t.op)}class Ou{constructor(){this.rn=new Lu}addToCollectionParentIndex(t,e){return this.rn.add(e),Ts.resolve()}getCollectionParents(t,e){return Ts.resolve(this.rn.getEntries(e))}addFieldIndex(t,e){return Ts.resolve()}deleteFieldIndex(t,e){return Ts.resolve()}getDocumentsMatchingTarget(t,e){return Ts.resolve(null)}getIndexType(t,e){return Ts.resolve(0)}getFieldIndexes(t,e){return Ts.resolve([])}getNextCollectionGroupToUpdate(t){return Ts.resolve(null)}getMinOffset(t,e){return Ts.resolve(ys.min())}getMinOffsetFromCollectionGroup(t,e){return Ts.resolve(ys.min())}updateCollectionGroup(t,e,n){return Ts.resolve()}updateIndexEntries(t,e){return Ts.resolve()}}class Lu{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new vi(os.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new vi(os.comparator)).toArray()}}const Pu=new Uint8Array(0);class Vu{constructor(t,e){this.user=t,this.databaseId=e,this.on=new Lu,this.un=new ea((t=>ko(t)),((t,e)=>Ro(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.on.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener((()=>{this.on.add(e)}));const s={collectionId:n,parent:Vs(r)};return qu(t).put(s)}return Ts.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[ns(e),""],!1,!0);return qu(t).j(r).next((t=>{for(const r of t){if(r.collectionId!==e)break;n.push(Us(r.parent))}return n}))}addFieldIndex(t,e){const n=Uu(t),r=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);delete r.indexId;const s=n.add(r);if(e.indexState){const n=ju(t);return s.next((t=>{n.put(uu(t,this.user,e.indexState.sequenceNumber,e.indexState.offset))}))}return s.next()}deleteFieldIndex(t,e){const n=Uu(t),r=ju(t),s=Bu(t);return n.delete(e.indexId).next((()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e){const n=Bu(t);let r=!0;const s=new Map;return Ts.forEach(this.cn(e),(e=>this.an(t,e).next((t=>{r&&(r=!!t),s.set(e,t)})))).next((()=>{if(r){let t=da();const r=[];return Ts.forEach(s,((s,i)=>{var o;Fr("IndexedDbIndexManager",`Using index ${o=s,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`} to execute ${ko(e)}`);const a=function(t,e){const n=ls(e);if(void 0===n)return null;for(const e of Fo(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(i,s),c=function(t,e){const n=new Map;for(const r of ds(e))for(const e of Fo(t,r.fieldPath))switch(e.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(i,s),u=function(t,e){const n=[];let r=!0;for(const s of ds(e)){const e=0===s.kind?Oo(t,s.fieldPath,t.startAt):Lo(t,s.fieldPath,t.startAt);n.push(e.value),r&&(r=e.inclusive)}return new so(n,r)}(i,s),h=function(t,e){const n=[];let r=!0;for(const s of ds(e)){const e=0===s.kind?Lo(t,s.fieldPath,t.endAt):Oo(t,s.fieldPath,t.endAt);n.push(e.value),r&&(r=e.inclusive)}return new so(n,r)}(i,s),l=this.hn(s,i,u),d=this.hn(s,i,h),f=this.ln(s,i,c),m=this.fn(s.indexId,a,l,u.inclusive,d,h.inclusive,f);return Ts.forEach(m,(s=>n.H(s,e.limit).next((e=>{e.forEach((e=>{const n=us.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),r.push(n))}))}))))})).next((()=>r))}return Ts.resolve(null)}))}cn(t){let e=this.un.get(t);return e||(e=0===t.filters.length?[t]:Du(lo.create(t.filters,"and")).map((e=>No(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt))),this.un.set(t,e),e)}fn(t,e,n,r,s,i,o){const a=(null!=e?e.length:1)*Math.max(n.length,s.length),c=a/(null!=e?e.length:1),u=[];for(let h=0;h<a;++h){const a=e?this.dn(e[h/c]):Pu,l=this.wn(t,a,n[h%c],r),d=this._n(t,a,s[h%c],i),f=o.map((e=>this.wn(t,a,e,!0)));u.push(...this.createRange(l,d,f))}return u}wn(t,e,n,r){const s=new Tu(t,us.empty(),e,n);return r?s:s.Je()}_n(t,e,n,r){const s=new Tu(t,us.empty(),e,n);return r?s.Je():s}an(t,e){const n=new Su(e),r=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,r).next((t=>{let e=null;for(const r of t)n.tn(r)&&(!e||r.fields.length>e.fields.length)&&(e=r);return e}))}getIndexType(t,e){let n=2;const r=this.cn(e);return Ts.forEach(r,(e=>this.an(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new vi(cs.comparator),n=!1;for(const r of t.filters)for(const t of r.getFlattenedFilters())t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field));for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>function(t){return null!==t.limit}(e)&&r.length>1&&2===n?1:n))}mn(t,e){const n=new Iu;for(const r of ds(t)){const t=e.data.field(r.fieldPath);if(null==t)return null;const s=n.He(r.kind);gu.Ve._e(t,s)}return n.Qe()}dn(t){const e=new Iu;return gu.Ve._e(t,e.He(0)),e.Qe()}gn(t,e){const n=new Iu;return gu.Ve._e(Gi(this.databaseId,e),n.He(function(t){const e=ds(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.Qe()}ln(t,e,n){if(null===n)return[];let r=[];r.push(new Iu);let s=0;for(const i of ds(t)){const t=n[s++];for(const n of r)if(this.yn(e,i.fieldPath)&&Ki(t))r=this.pn(r,i,t);else{const e=n.He(i.kind);gu.Ve._e(t,e)}}return this.In(r)}hn(t,e,n){return this.ln(t,e,n.position)}In(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Qe();return e}pn(t,e,n){const r=[...t],s=[];for(const t of n.arrayValue.values||[])for(const n of r){const r=new Iu;r.seed(n.Qe()),gu.Ve._e(t,r.He(e.kind)),s.push(r)}return s}yn(t,e){return!!t.filters.find((t=>t instanceof ho&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=Uu(t),r=ju(t);return(e?n.j("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.j()).next((t=>{const e=[];return Ts.forEach(t,(t=>r.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new ms(e.sequenceNumber,new ys(nu(e.readTime),new us(Us(e.documentKey)),e.largestBatchId)):ms.empty(),r=t.fields.map((([t,e])=>new fs(cs.fromServerFormat(t),e)));return new hs(t.indexId,t.collectionGroup,r,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:ts(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const r=Uu(t),s=ju(t);return this.Tn(t).next((t=>r.j("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>Ts.forEach(e,(e=>s.put(uu(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return Ts.forEach(e,((e,r)=>{const s=n.get(e.collectionGroup);return(s?Ts.resolve(s):this.getFieldIndexes(t,e.collectionGroup)).next((s=>(n.set(e.collectionGroup,s),Ts.forEach(s,(n=>this.En(t,e,n).next((e=>{const s=this.An(r,n);return e.isEqual(s)?Ts.resolve():this.vn(t,r,n,e,s)})))))))}))}Rn(t,e,n,r){return Bu(t).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,e.key),documentKey:e.key.path.toArray()})}Pn(t,e,n,r){return Bu(t).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,e.key),e.key.path.toArray()])}En(t,e,n){const r=Bu(t);let s=new vi(Eu);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,e)])},((t,r)=>{s=s.add(new Tu(n.indexId,e,r.arrayValue,r.directionalValue))})).next((()=>s))}An(t,e){let n=new vi(Eu);const r=this.mn(e,t);if(null==r)return n;const s=ls(e);if(null!=s){const i=t.data.field(s.fieldPath);if(Ki(i))for(const s of i.arrayValue.values||[])n=n.add(new Tu(e.indexId,t.key,this.dn(s),r))}else n=n.add(new Tu(e.indexId,t.key,Pu,r));return n}vn(t,e,n,r,s){Fr("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const i=[];return function(t,e,n,r,s){const i=t.getIterator(),o=e.getIterator();let a=Ii(i),c=Ii(o);for(;a||c;){let t=!1,e=!1;if(a&&c){const r=n(a,c);r<0?e=!0:r>0&&(t=!0)}else null!=a?e=!0:t=!0;t?(r(c),c=Ii(o)):e?(s(a),a=Ii(i)):(a=Ii(i),c=Ii(o))}}(r,s,Eu,(r=>{i.push(this.Rn(t,e,n,r))}),(r=>{i.push(this.Pn(t,e,n,r))})),Ts.waitFor(i)}Tn(t){let e=1;return ju(t).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,r)=>{r.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>Eu(t,e))).filter(((t,e,n)=>!e||0!==Eu(t,n[e-1])));const r=[];r.push(t);for(const s of n){const n=Eu(s,t),i=Eu(s,e);if(0===n)r[0]=t.Je();else if(n>0&&i<0)r.push(s),r.push(s.Je());else if(i>0)break}r.push(e);const s=[];for(let t=0;t<r.length;t+=2){if(this.bn(r[t],r[t+1]))return[];const e=[r[t].indexId,this.uid,r[t].arrayValue,r[t].directionalValue,Pu,[]],n=[r[t+1].indexId,this.uid,r[t+1].arrayValue,r[t+1].directionalValue,Pu,[]];s.push(IDBKeyRange.bound(e,n))}return s}bn(t,e){return Eu(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Gu)}getMinOffset(t,e){return Ts.mapArray(this.cn(e),(e=>this.an(t,e).next((t=>t||Vr())))).next(Gu)}}function qu(t){return di(t,"collectionParents")}function Bu(t){return di(t,"indexEntries")}function Uu(t){return di(t,"indexConfiguration")}function ju(t){return di(t,"indexState")}function Gu(t){qr(0!==t.length);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;ws(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new ys(e.readTime,e.documentKey,n)}const zu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ku{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Ku(t,Ku.DEFAULT_COLLECTION_PERCENTILE,Ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function $u(t,e,n){const r=t.store("mutations"),s=t.store("documentMutations"),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},((t,e,n)=>(a++,n.delete())));i.push(c.next((()=>{qr(1===a)})));const u=[];for(const t of n.mutations){const r=zs(e,t.key.path,n.batchId);i.push(s.delete(r)),u.push(t.key)}return Ts.waitFor(i).next((()=>u))}function Qu(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Vr();e=t.noDocument}return JSON.stringify(e).length}Ku.DEFAULT_COLLECTION_PERCENTILE=10,Ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ku.DEFAULT=new Ku(41943040,Ku.DEFAULT_COLLECTION_PERCENTILE,Ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ku.DISABLED=new Ku(-1,0,0);class Wu{constructor(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(t,e,n,r){qr(""!==t.uid);const s=t.isAuthenticated()?t.uid:"";return new Wu(s,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xu(t).X({index:"userMutationsIndex",range:n},((t,n,r)=>{e=!1,r.done()})).next((()=>e))}addMutationBatch(t,e,n,r){const s=Yu(t),i=Xu(t);return i.add({}).next((o=>{qr("number"==typeof o);const a=new Qa(o,e,n,r),c=function(t,e,n){const r=n.baseMutations.map((e=>Pc(t.fe,e))),s=n.mutations.map((e=>Pc(t.fe,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:s}}(this.serializer,this.userId,a),u=[];let h=new vi(((t,e)=>ts(t.canonicalString(),e.canonicalString())));for(const t of r){const e=zs(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(i.put(c)),u.push(s.put(e,Ks))}return h.forEach((e=>{u.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Vn[o]=a.keys()})),Ts.waitFor(u).next((()=>a))}))}lookupMutationBatch(t,e){return Xu(t).get(e).next((t=>t?(qr(t.userId===this.userId),ru(this.serializer,t)):null))}Sn(t,e){return this.Vn[e]?Ts.resolve(this.Vn[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Vn[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Xu(t).X({index:"userMutationsIndex",range:r},((t,e,r)=>{e.userId===this.userId&&(qr(e.batchId>=n),s=ru(this.serializer,e)),r.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Xu(t).X({index:"userMutationsIndex",range:e,reverse:!0},((t,e,r)=>{n=e.batchId,r.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xu(t).j("userMutationsIndex",e).next((t=>t.map((t=>ru(this.serializer,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Gs(this.userId,e.path),r=IDBKeyRange.lowerBound(n),s=[];return Yu(t).X({range:r},((n,r,i)=>{const[o,a,c]=n,u=Us(a);if(o===this.userId&&e.path.isEqual(u))return Xu(t).get(c).next((t=>{if(!t)throw Vr();qr(t.userId===this.userId),s.push(ru(this.serializer,t))}));i.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new vi(ts);const r=[];return e.forEach((e=>{const s=Gs(this.userId,e.path),i=IDBKeyRange.lowerBound(s),o=Yu(t).X({range:i},((t,r,s)=>{const[i,o,a]=t,c=Us(o);i===this.userId&&e.path.isEqual(c)?n=n.add(a):s.done()}));r.push(o)})),Ts.waitFor(r).next((()=>this.Dn(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,s=Gs(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new vi(ts);return Yu(t).X({range:i},((t,e,s)=>{const[i,a,c]=t,u=Us(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()})).next((()=>this.Dn(t,o)))}Dn(t,e){const n=[],r=[];return e.forEach((e=>{r.push(Xu(t).get(e).next((t=>{if(null===t)throw Vr();qr(t.userId===this.userId),n.push(ru(this.serializer,t))})))})),Ts.waitFor(r).next((()=>n))}removeMutationBatch(t,e){return $u(t.ht,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Cn(e.batchId)})),Ts.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Cn(t){delete this.Vn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Ts.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return Yu(t).X({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=Us(t[1]);r.push(e)}else n.done()})).next((()=>{qr(0===r.length)}))}))}containsKey(t,e){return Hu(t,this.userId,e)}xn(t){return Ju(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Hu(t,e,n){const r=Gs(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Yu(t).X({range:i,Y:!0},((t,n,r)=>{const[i,a,c]=t;i===e&&a===s&&(o=!0),r.done()})).next((()=>o))}function Xu(t){return di(t,"mutations")}function Yu(t){return di(t,"documentMutations")}function Ju(t){return di(t,"mutationQueues")}class Zu{constructor(t){this.Nn=t}next(){return this.Nn+=2,this.Nn}static kn(){return new Zu(0)}static Mn(){return new Zu(-1)}}class th{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.$n(t).next((e=>{const n=new Zu(e.highestTargetId);return e.highestTargetId=n.next(),this.On(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.$n(t).next((t=>ss.fromTimestamp(new rs(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.$n(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.$n(t).next((r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.On(t,r))))}addTargetData(t,e){return this.Fn(t,e).next((()=>this.$n(t).next((n=>(n.targetCount+=1,this.Bn(e,n),this.On(t,n))))))}updateTargetData(t,e){return this.Fn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>eh(t).delete(e.targetId))).next((()=>this.$n(t))).next((e=>(qr(e.targetCount>0),e.targetCount-=1,this.On(t,e))))}removeTargets(t,e,n){let r=0;const s=[];return eh(t).X(((i,o)=>{const a=su(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(t,a)))})).next((()=>Ts.waitFor(s))).next((()=>r))}forEachTarget(t,e){return eh(t).X(((t,n)=>{const r=su(n);e(r)}))}$n(t){return nh(t).get("targetGlobalKey").next((t=>(qr(null!==t),t)))}On(t,e){return nh(t).put("targetGlobalKey",e)}Fn(t,e){return eh(t).put(iu(this.serializer,e))}Bn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.$n(t).next((t=>t.targetCount))}getTargetData(t,e){const n=ko(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return eh(t).X({range:r,index:"queryTargetsIndex"},((t,n,r)=>{const i=su(n);Ro(e,i.target)&&(s=i,r.done())})).next((()=>s))}addMatchingKeys(t,e,n){const r=[],s=rh(t);return e.forEach((e=>{const i=Vs(e.path);r.push(s.put({targetId:n,path:i})),r.push(this.referenceDelegate.addReference(t,n,e))})),Ts.waitFor(r)}removeMatchingKeys(t,e,n){const r=rh(t);return Ts.forEach(e,(e=>{const s=Vs(e.path);return Ts.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=rh(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=rh(t);let s=da();return r.X({range:n,Y:!0},((t,e,n)=>{const r=Us(t[1]),i=new us(r);s=s.add(i)})).next((()=>s))}containsKey(t,e){const n=Vs(e.path),r=IDBKeyRange.bound([n],[ns(n)],!1,!0);let s=0;return rh(t).X({index:"documentTargetsIndex",Y:!0,range:r},(([t,e],n,r)=>{0!==t&&(s++,r.done())})).next((()=>s>0))}le(t,e){return eh(t).get(e).next((t=>t?su(t):null))}}function eh(t){return di(t,"targets")}function nh(t){return di(t,"targetGlobal")}function rh(t){return di(t,"targetDocuments")}function sh([t,e],[n,r]){const s=ts(t,n);return 0===s?ts(e,r):s}class ih{constructor(t){this.Ln=t,this.buffer=new vi(sh),this.qn=0}Un(){return++this.qn}Kn(t){const e=[t,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();sh(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class oh{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(t){Fr("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ds(t)?Fr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Is(t)}await this.Qn(3e5)}))}}class ah{constructor(t,e){this.jn=t,this.params=e}calculateTargetCount(t,e){return this.jn.zn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Ts.resolve(Fs.ct);const n=new ih(e);return this.jn.forEachTarget(t,(t=>n.Kn(t.sequenceNumber))).next((()=>this.jn.Wn(t,(t=>n.Kn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.jn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.jn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Fr("LruGarbageCollector","Garbage collection skipped; disabled"),Ts.resolve(zu)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(Fr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zu):this.Hn(t,e)))}getCacheSize(t){return this.jn.getCacheSize(t)}Hn(t,e){let n,r,s,i,o,c,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(Fr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(u=Date.now(),Mr()<=a.in.DEBUG&&Fr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-h}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(c-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-h}ms`),Ts.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t}))))}}function ch(t,e){return new ah(t,e)}class uh{constructor(t,e){this.db=t,this.garbageCollector=ch(this,e)}zn(t){const e=this.Jn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Jn(t){let e=0;return this.Wn(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Wn(t,e){return this.Yn(t,((t,n)=>e(n)))}addReference(t,e,n){return hh(t,n)}removeReference(t,e,n){return hh(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return hh(t,e)}Xn(t,e){return function(t,e){let n=!1;return Ju(t).Z((r=>Hu(t,r,e).next((t=>(t&&(n=!0),Ts.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Yn(t,((i,o)=>{if(o<=e){const e=this.Xn(t,i).next((e=>{if(!e)return s++,n.getEntry(t,i).next((()=>(n.removeEntry(i,ss.min()),rh(t).delete([0,Vs(i.path)]))))}));r.push(e)}})).next((()=>Ts.waitFor(r))).next((()=>n.apply(t))).next((()=>s))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return hh(t,e)}Yn(t,e){const n=rh(t);let r,s=Fs.ct;return n.X({index:"documentTargetsIndex"},(([t,n],{path:i,sequenceNumber:o})=>{0===t?(s!==Fs.ct&&e(new us(Us(r)),s),s=o,r=i):s=Fs.ct})).next((()=>{s!==Fs.ct&&e(new us(Us(r)),s)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function hh(t,e){return rh(t).put(function(t,e){return{targetId:0,path:Vs(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}class lh{constructor(){this.changes=new ea((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ro.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ts.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class dh{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return ph(t).put(n)}removeEntry(t,e,n){return ph(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],tu(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Zn(t,n))))}getEntry(t,e){let n=ro.newInvalidDocument(e);return ph(t).X({index:"documentKeyIndex",range:IDBKeyRange.only(yh(e))},((t,r)=>{n=this.ts(e,r)})).next((()=>n))}es(t,e){let n={size:0,document:ro.newInvalidDocument(e)};return ph(t).X({index:"documentKeyIndex",range:IDBKeyRange.only(yh(e))},((t,r)=>{n={document:this.ts(e,r),size:Qu(r)}})).next((()=>n))}getEntries(t,e){let n=ra();return this.ns(t,e,((t,e)=>{const r=this.ts(t,e);n=n.insert(t,r)})).next((()=>n))}ss(t,e){let n=ra(),r=new pi(us.comparator);return this.ns(t,e,((t,e)=>{const s=this.ts(t,e);n=n.insert(t,s),r=r.insert(t,Qu(e))})).next((()=>({documents:n,rs:r})))}ns(t,e,n){if(e.isEmpty())return Ts.resolve();let r=new vi(vh);e.forEach((t=>r=r.add(t)));const s=IDBKeyRange.bound(yh(r.first()),yh(r.last())),i=r.getIterator();let o=i.getNext();return ph(t).X({index:"documentKeyIndex",range:s},((t,e,r)=>{const s=us.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&vh(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.G(yh(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(t,e,n,r){const s=e.path,i=[s.popLast().toArray(),s.lastSegment(),tu(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ph(t).j(IDBKeyRange.bound(i,o,!0)).next((t=>{let n=ra();for(const s of t){const t=this.ts(us.fromSegments(s.prefixPath.concat(s.collectionGroup,s.documentId)),s);t.isFoundDocument()&&(Yo(e,t)||r.has(t.key))&&(n=n.insert(t.key,t))}return n}))}getAllFromCollectionGroup(t,e,n,r){let s=ra();const i=wh(e,n),o=wh(e,ys.max());return ph(t).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(i,o,!0)},((t,e,n)=>{const i=this.ts(us.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);s=s.insert(i.key,i),s.size===r&&n.done()})).next((()=>s))}newChangeBuffer(t){return new mh(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return gh(t).get("remoteDocumentGlobalKey").next((t=>(qr(!!t),t)))}Zn(t,e){return gh(t).put("remoteDocumentGlobalKey",e)}ts(t,e){if(e){const t=function(t,e){let n;if(e.document)n=Lc(t.fe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=us.fromSegments(e.noDocument.path),r=nu(e.noDocument.readTime);n=ro.newNoDocument(t,r),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return Vr();{const t=us.fromSegments(e.unknownDocument.path),r=nu(e.unknownDocument.version);n=ro.newUnknownDocument(t,r)}}return e.readTime&&n.setReadTime(function(t){const e=new rs(t[0],t[1]);return ss.fromTimestamp(e)}(e.readTime)),n}(this.serializer,e);if(!t.isNoDocument()||!t.version.isEqual(ss.min()))return t}return ro.newInvalidDocument(t)}}function fh(t){return new dh(t)}class mh extends lh{constructor(t,e){super(),this.os=t,this.trackRemovals=e,this.us=new ea((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,r=new vi(((t,e)=>ts(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((s,i)=>{const o=this.us.get(s);if(e.push(this.os.removeEntry(t,s,o.readTime)),i.isValidDocument()){const a=Zc(this.os.serializer,i);r=r.add(s.path.popLast());const c=Qu(a);n+=c-o.size,e.push(this.os.addEntry(t,s,a))}else if(n-=o.size,this.trackRemovals){const n=Zc(this.os.serializer,i.convertToNoDocument(ss.min()));e.push(this.os.addEntry(t,s,n))}})),r.forEach((n=>{e.push(this.os.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.os.updateMetadata(t,n)),Ts.waitFor(e)}getFromCache(t,e){return this.os.es(t,e).next((t=>(this.us.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this.os.ss(t,e).next((({documents:t,rs:e})=>(e.forEach(((e,n)=>{this.us.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function gh(t){return di(t,"remoteDocumentGlobal")}function ph(t){return di(t,"remoteDocumentsV14")}function yh(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function wh(t,e){const n=e.documentKey.path.toArray();return[t,tu(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function vh(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let t=0;t<n.length-2&&t<r.length-2;++t)if(s=ts(n[t],r[t]),s)return s;return s=ts(n.length,r.length),s||(s=ts(n[n.length-2],r[r.length-2]),s||ts(n[n.length-1],r[r.length-1]))}class bh{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ih{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Pa(n.mutation,t,Ti.empty(),rs.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,da()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=da()){const r=aa();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=ia();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=aa();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,da())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=ra();const i=ua(),o=ua();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Ua)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),Pa(o.mutation,e,o.mutation.getFieldMask(),rs.now())):i.set(e.key,Ti.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new bh(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=ua();let r=new pi(((t,e)=>t-e)),s=da();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||Ti.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||da()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=ca();c.forEach((t=>{if(!s.has(t)){const r=Oa(e.get(t),n.get(t));null!==r&&u.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,u))}return Ts.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return us.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Go(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):Ts.resolve(aa());let o=-1,a=s;return i.next((e=>Ts.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?Ts.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,da()))).next((t=>({batchId:o,changes:oa(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new us(e)).next((t=>{let e=ia();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const r=e.collectionGroup;let s=ia();return this.indexManager.getCollectionParents(t,r).next((i=>Ts.forEach(i,(i=>{const o=function(t,e){return new Po(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(r));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,r)))).next((t=>{r.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,ro.newInvalidDocument(r)))}));let n=ia();return t.forEach(((t,s)=>{const i=r.get(t);void 0!==i&&Pa(i.mutation,s,Ti.empty(),rs.now()),Yo(e,s)&&(n=n.insert(t,s))})),n}))}}class Th{constructor(t){this.serializer=t,this.cs=new Map,this.hs=new Map}getBundleMetadata(t,e){return Ts.resolve(this.cs.get(e))}saveBundleMetadata(t,e){var n;return this.cs.set(e.id,{id:(n=e).id,version:n.version,createTime:xc(n.createTime)}),Ts.resolve()}getNamedQuery(t,e){return Ts.resolve(this.hs.get(e))}saveNamedQuery(t,e){return this.hs.set(e.name,function(t){return{name:t.name,query:ou(t.bundledQuery),readTime:xc(t.readTime)}}(e)),Ts.resolve()}}class Eh{constructor(){this.overlays=new pi(us.comparator),this.ls=new Map}getOverlay(t,e){return Ts.resolve(this.overlays.get(e))}getOverlays(t,e){const n=aa();return Ts.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.we(t,e,r)})),Ts.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.ls.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.ls.delete(n)),Ts.resolve()}getOverlaysForCollection(t,e,n){const r=aa(),s=e.length+1,i=new us(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Ts.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new pi(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=aa(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=aa(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Ts.resolve(o)}we(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ha(e,n));let s=this.ls.get(e);void 0===s&&(s=da(),this.ls.set(e,s)),this.ls.set(e,s.add(n.key))}}class _h{constructor(){this.fs=new vi(Sh.ds),this.ws=new vi(Sh._s)}isEmpty(){return this.fs.isEmpty()}addReference(t,e){const n=new Sh(t,e);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ys(new Sh(t,e))}ps(t,e){t.forEach((t=>this.removeReference(t,e)))}Is(t){const e=new us(new os([])),n=new Sh(e,t),r=new Sh(e,t+1),s=[];return this.ws.forEachInRange([n,r],(t=>{this.ys(t),s.push(t.key)})),s}Ts(){this.fs.forEach((t=>this.ys(t)))}ys(t){this.fs=this.fs.delete(t),this.ws=this.ws.delete(t)}Es(t){const e=new us(new os([])),n=new Sh(e,t),r=new Sh(e,t+1);let s=da();return this.ws.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Sh(t,0),n=this.fs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Sh{constructor(t,e){this.key=t,this.As=e}static ds(t,e){return us.comparator(t.key,e.key)||ts(t.As,e.As)}static _s(t,e){return ts(t.As,e.As)||us.comparator(t.key,e.key)}}class xh{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.vs=1,this.Rs=new vi(Sh.ds)}checkEmpty(t){return Ts.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Qa(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.Rs=this.Rs.add(new Sh(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ts.resolve(i)}lookupMutationBatch(t,e){return Ts.resolve(this.Ps(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.bs(n),s=r<0?0:r;return Ts.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Ts.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(t){return Ts.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Sh(e,0),r=new Sh(e,Number.POSITIVE_INFINITY),s=[];return this.Rs.forEachInRange([n,r],(t=>{const e=this.Ps(t.As);s.push(e)})),Ts.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new vi(ts);return e.forEach((t=>{const e=new Sh(t,0),r=new Sh(t,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([e,r],(t=>{n=n.add(t.As)}))})),Ts.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;us.isDocumentKey(s)||(s=s.child(""));const i=new Sh(new us(s),0);let o=new vi(ts);return this.Rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.As)),!0)}),i),Ts.resolve(this.Vs(o))}Vs(t){const e=[];return t.forEach((t=>{const n=this.Ps(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){qr(0===this.Ss(e.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return Ts.forEach(e.mutations,(r=>{const s=new Sh(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.Rs=n}))}Cn(t){}containsKey(t,e){const n=new Sh(e,0),r=this.Rs.firstAfterOrEqual(n);return Ts.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ts.resolve()}Ss(t,e){return this.bs(t)}bs(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Ps(t){const e=this.bs(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Dh{constructor(t){this.Ds=t,this.docs=new pi(us.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.Ds(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ts.resolve(n?n.document.mutableCopy():ro.newInvalidDocument(e))}getEntries(t,e){let n=ra();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():ro.newInvalidDocument(t))})),Ts.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=ra();const i=e.path,o=new us(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||ws(ps(o),n)<=0||(r.has(o.key)||Yo(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Ts.resolve(s)}getAllFromCollectionGroup(t,e,n,r){Vr()}Cs(t,e){return Ts.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Ch(this)}getSize(t){return Ts.resolve(this.size)}}class Ch extends lh{constructor(t){super(),this.os=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.os.addEntry(t,r)):this.os.removeEntry(n)})),Ts.waitFor(e)}getFromCache(t,e){return this.os.getEntry(t,e)}getAllFromCache(t,e){return this.os.getEntries(t,e)}}class Ah{constructor(t){this.persistence=t,this.xs=new ea((t=>ko(t)),Ro),this.lastRemoteSnapshotVersion=ss.min(),this.highestTargetId=0,this.Ns=0,this.ks=new _h,this.targetCount=0,this.Ms=Zu.kn()}forEachTarget(t,e){return this.xs.forEach(((t,n)=>e(n))),Ts.resolve()}getLastRemoteSnapshotVersion(t){return Ts.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ts.resolve(this.Ns)}allocateTargetId(t){return this.highestTargetId=this.Ms.next(),Ts.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ns&&(this.Ns=e),Ts.resolve()}Fn(t){this.xs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ms=new Zu(e),this.highestTargetId=e),t.sequenceNumber>this.Ns&&(this.Ns=t.sequenceNumber)}addTargetData(t,e){return this.Fn(e),this.targetCount+=1,Ts.resolve()}updateTargetData(t,e){return this.Fn(e),Ts.resolve()}removeTargetData(t,e){return this.xs.delete(e.target),this.ks.Is(e.targetId),this.targetCount-=1,Ts.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.xs.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.xs.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Ts.waitFor(s).next((()=>r))}getTargetCount(t){return Ts.resolve(this.targetCount)}getTargetData(t,e){const n=this.xs.get(e)||null;return Ts.resolve(n)}addMatchingKeys(t,e,n){return this.ks.gs(e,n),Ts.resolve()}removeMatchingKeys(t,e,n){this.ks.ps(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Ts.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.ks.Is(e),Ts.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ks.Es(e);return Ts.resolve(n)}containsKey(t,e){return Ts.resolve(this.ks.containsKey(e))}}class Nh{constructor(t,e){this.$s={},this.overlays={},this.Os=new Fs(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=t(this),this.Bs=new Ah(this),this.indexManager=new Ou,this.remoteDocumentCache=function(t){return new Dh(t)}((t=>this.referenceDelegate.Ls(t))),this.serializer=new Jc(e),this.qs=new Th(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Eh,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.$s[t.toKey()];return n||(n=new xh(e,this.referenceDelegate),this.$s[t.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(t,e,n){Fr("MemoryPersistence","Starting transaction:",t);const r=new kh(this.Os.next());return this.referenceDelegate.Us(),n(r).next((t=>this.referenceDelegate.Ks(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gs(t,e){return Ts.or(Object.values(this.$s).map((n=>()=>n.containsKey(t,e))))}}class kh extends bs{constructor(t){super(),this.currentSequenceNumber=t}}class Rh{constructor(t){this.persistence=t,this.Qs=new _h,this.js=null}static zs(t){return new Rh(t)}get Ws(){if(this.js)return this.js;throw Vr()}addReference(t,e,n){return this.Qs.addReference(n,e),this.Ws.delete(n.toString()),Ts.resolve()}removeReference(t,e,n){return this.Qs.removeReference(n,e),this.Ws.add(n.toString()),Ts.resolve()}markPotentiallyOrphaned(t,e){return this.Ws.add(e.toString()),Ts.resolve()}removeTarget(t,e){this.Qs.Is(e.targetId).forEach((t=>this.Ws.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ws.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Us(){this.js=new Set}Ks(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ts.forEach(this.Ws,(n=>{const r=us.fromPath(n);return this.Hs(t,r).next((t=>{t||e.removeEntry(r,ss.min())}))})).next((()=>(this.js=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hs(t,e).next((t=>{t?this.Ws.delete(e.toString()):this.Ws.add(e.toString())}))}Ls(t){return 0}Hs(t,e){return Ts.or([()=>Ts.resolve(this.Qs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gs(t,e)])}}class Mh{constructor(t){this.serializer=t}O(t,e,n,r){const s=new Es("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"}),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",js,{unique:!0}),t.createObjectStore("documentMutations")}(t),Fh(t),function(t){t.createObjectStore("remoteDocuments")}(t));let i=Ts.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),Fh(t)),i=i.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ss.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(s)))),n<4&&r>=4&&(0!==n&&(i=i.next((()=>function(t,e){return e.store("mutations").j().next((n=>{t.deleteObjectStore("mutations"),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",js,{unique:!0});const r=e.store("mutations"),s=n.map((t=>r.put(t)));return Ts.waitFor(s)}))}(t,s)))),i=i.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&r>=5&&(i=i.next((()=>this.Ys(s)))),n<6&&r>=6&&(i=i.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.Xs(s))))),n<7&&r>=7&&(i=i.next((()=>this.Zs(s)))),n<8&&r>=8&&(i=i.next((()=>this.ti(t,s)))),n<9&&r>=9&&(i=i.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&r>=10&&(i=i.next((()=>this.ei(s)))),n<11&&r>=11&&(i=i.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&r>=12&&(i=i.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:ri});e.createIndex("collectionPathOverlayIndex",si,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",ii,{unique:!1})}(t)}))),n<13&&r>=13&&(i=i.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:$s});e.createIndex("documentKeyIndex",Qs),e.createIndex("collectionGroupIndex",Ws)}(t))).next((()=>this.ni(t,s))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(i=i.next((()=>this.si(t,s)))),n<15&&r>=15&&(i=i.next((()=>function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),t.createObjectStore("indexState",{keyPath:Zs}).createIndex("sequenceNumberIndex",ti,{unique:!1}),t.createObjectStore("indexEntries",{keyPath:ei}).createIndex("documentKeyIndex",ni,{unique:!1})}(t)))),i}Xs(t){let e=0;return t.store("remoteDocuments").X(((t,n)=>{e+=Qu(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Ys(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.j().next((e=>Ts.forEach(e,(e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next((n=>Ts.forEach(n,(n=>{qr(n.userId===e.userId);const r=ru(this.serializer,n);return $u(t,e.userId,r).next((()=>{}))}))))}))))}Zs(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const r=[];return n.X(((n,s)=>{const i=new os(n),o=function(t){return[0,Vs(t)]}(i);r.push(e.get(o).next((n=>n?Ts.resolve():(n=>e.put({targetId:0,path:Vs(n),sequenceNumber:t.highestListenSequenceNumber}))(i))))})).next((()=>Ts.waitFor(r)))}))}ti(t,e){t.createObjectStore("collectionParents",{keyPath:Js});const n=e.store("collectionParents"),r=new Lu,s=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:Vs(r)})}};return e.store("remoteDocuments").X({Y:!0},((t,e)=>{const n=new os(t);return s(n.popLast())})).next((()=>e.store("documentMutations").X({Y:!0},(([t,e,n],r)=>{const i=Us(e);return s(i.popLast())}))))}ei(t){const e=t.store("targets");return e.X(((t,n)=>{const r=su(n),s=iu(this.serializer,r);return e.put(s)}))}ni(t,e){const n=e.store("remoteDocuments"),r=[];return n.X(((t,n)=>{const s=e.store("remoteDocumentsV14"),i=(o=n,o.document?new us(os.fromString(o.document.name).popFirst(5)):o.noDocument?us.fromSegments(o.noDocument.path):o.unknownDocument?us.fromSegments(o.unknownDocument.path):Vr()).path.toArray();var o;const a={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(s.put(a))})).next((()=>Ts.waitFor(r)))}si(t,e){const n=e.store("mutations"),r=fh(this.serializer),s=new Nh(Rh.zs,this.serializer.fe);return n.j().next((t=>{const n=new Map;return t.forEach((t=>{var e;let r=null!==(e=n.get(t.userId))&&void 0!==e?e:da();ru(this.serializer,t).keys().forEach((t=>r=r.add(t))),n.set(t.userId,r)})),Ts.forEach(n,((t,n)=>{const i=new Nr(n),o=fu.de(this.serializer,i),a=s.getIndexManager(i),c=Wu.de(i,this.serializer,a,s.referenceDelegate);return new Ih(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new li(e,Fs.ct),t).next()}))}))}}function Fh(t){t.createObjectStore("targetDocuments",{keyPath:Xs}).createIndex("documentTargetsIndex",Ys,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Hs,{unique:!0}),t.createObjectStore("targetGlobal")}const Oh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Lh{constructor(t,e,n,r,s,i,o,a,c,u,h=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.ii=s,this.window=i,this.document=o,this.ri=c,this.oi=u,this.ui=h,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=t=>Promise.resolve(),!Lh.D())throw new jr(Ur.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new uh(this,r),this.di=e+"main",this.serializer=new Jc(a),this.wi=new _s(this.di,this.ui,new Mh(this.serializer)),this.Bs=new th(this.referenceDelegate,this.serializer),this.remoteDocumentCache=fh(this.serializer),this.qs=new hu,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&Or("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new jr(Ur.FAILED_PRECONDITION,Oh);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Bs.getHighestSequenceNumber(t)))})).then((t=>{this.Os=new Fs(t,this.ri)})).then((()=>{this.Fs=!0})).catch((t=>(this.wi&&this.wi.close(),Promise.reject(t))))}Ii(t){return this.fi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.wi.B((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.ii.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Vh(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ti(t).next((t=>{t||(this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Ei(t))).next((e=>this.isPrimary&&!e?this.Ai(t).next((()=>!1)):!!e&&this.vi(t).next((()=>!0)))))).catch((t=>{if(Ds(t))return Fr("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Fr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.ii.enqueueRetryable((()=>this.fi(t))),this.isPrimary=t}))}Ti(t){return Ph(t).get("owner").next((t=>Ts.resolve(this.Ri(t))))}Pi(t){return Vh(t).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=di(t,"clientMetadata");return e.j().next((t=>{const n=this.Si(t,18e5),r=t.filter((t=>-1===n.indexOf(t)));return Ts.forEach(r,(t=>e.delete(t.clientId))).next((()=>r))}))})).catch((()=>[]));if(this._i)for(const e of t)this._i.removeItem(this.Di(e.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.bi())).then((()=>this.pi()))))}Ri(t){return!!t&&t.ownerId===this.clientId}Ei(t){return this.oi?Ts.resolve(!0):Ph(t).get("owner").next((e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)){if(this.Ri(e)&&this.networkEnabled)return!0;if(!this.Ri(e)){if(!e.allowTabSynchronization)throw new jr(Ur.FAILED_PRECONDITION,Oh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vh(t).j().next((t=>void 0===this.Si(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&Fr("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new li(t,Fs.ct);return this.Ai(e).next((()=>this.Pi(e)))})),this.wi.close(),this.Mi()}Si(t,e){return t.filter((t=>this.Vi(t.updateTimeMs,e)&&!this.Ci(t.clientId)))}$i(){return this.runTransaction("getActiveClients","readonly",(t=>Vh(t).j().next((t=>this.Si(t,18e5).map((t=>t.clientId))))))}get started(){return this.Fs}getMutationQueue(t,e){return Wu.de(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Vu(t,this.serializer.fe.databaseId)}getDocumentOverlayCache(t){return fu.de(this.serializer,t)}getBundleCache(){return this.qs}runTransaction(t,e,n){Fr("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite",s=15===(i=this.ui)?hi:14===i?ui:13===i?ci:12===i?ai:11===i?oi:void Vr();var i;let o;return this.wi.runTransaction(t,r,s,(r=>(o=new li(r,this.Os?this.Os.next():Fs.ct),"readwrite-primary"===e?this.Ti(o).next((t=>!!t||this.Ei(o))).next((e=>{if(!e)throw Or(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))),new jr(Ur.FAILED_PRECONDITION,vs);return n(o)})).next((t=>this.vi(o).next((()=>t)))):this.Oi(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}Oi(t){return Ph(t).get("owner").next((t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)&&!this.Ri(t)&&!(this.oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new jr(Ur.FAILED_PRECONDITION,Oh)}))}vi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ph(t).put("owner",e)}static D(){return _s.D()}Ai(t){const e=Ph(t);return e.get("owner").next((t=>this.Ri(t)?(Fr("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):Ts.resolve()))}Vi(t,e){const n=Date.now();return!(t<n-e||t>n&&(Or(`Detected an update time that is in the future: ${t} > ${n}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,c.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(t){var e;try{const n=null!==(null===(e=this._i)||void 0===e?void 0:e.getItem(this.Di(t)));return Fr("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Or("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(t){Or("Failed to set zombie client id.",t)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(t){}}Di(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Ph(t){return di(t,"owner")}function Vh(t){return di(t,"clientMetadata")}function qh(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Bh{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Fi=n,this.Bi=r}static Li(t,e){let n=da(),r=da();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Bh(t,e.fromCache,n,r)}}class Uh{constructor(){this.qi=!1}initialize(t,e){this.Ui=t,this.indexManager=e,this.qi=!0}getDocumentsMatchingQuery(t,e,n,r){return this.Ki(t,e).next((s=>s||this.Gi(t,e,r,n))).next((n=>n||this.Qi(t,e)))}Ki(t,e){if(Bo(e))return Ts.resolve(null);let n=Ko(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Qo(e,null,"F"),n=Ko(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=da(...r);return this.Ui.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.ji(e,r);return this.zi(e,i,s,n.readTime)?this.Ki(t,Qo(e,null,"F")):this.Wi(t,i,e,n)}))))})))))}Gi(t,e,n,r){return Bo(e)||r.isEqual(ss.min())?this.Qi(t,e):this.Ui.getDocuments(t,n).next((s=>{const i=this.ji(e,s);return this.zi(e,i,n,r)?this.Qi(t,e):(Mr()<=a.in.DEBUG&&Fr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Xo(e)),this.Wi(t,i,e,gs(r,-1)))}))}ji(t,e){let n=new vi(Zo(t));return e.forEach(((e,r)=>{Yo(t,r)&&(n=n.add(r))})),n}zi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Qi(t,e){return Mr()<=a.in.DEBUG&&Fr("QueryEngine","Using full collection scan to execute query:",Xo(e)),this.Ui.getDocumentsMatchingQuery(t,e,ys.min())}Wi(t,e,n,r){return this.Ui.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class jh{constructor(t,e,n,r){this.persistence=t,this.Hi=e,this.serializer=r,this.Ji=new pi(ts),this.Yi=new ea((t=>ko(t)),Ro),this.Xi=new Map,this.Zi=t.getRemoteDocumentCache(),this.Bs=t.getTargetCache(),this.qs=t.getBundleCache(),this.tr(n)}tr(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ih(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}function Gh(t,e,n,r){return new jh(t,e,n,r)}async function zh(t,e){const n=Br(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n.tr(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=da();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({er:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function Kh(t){const e=Br(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Bs.getLastRemoteSnapshotVersion(t)))}function $h(t,e,n){let r=da(),s=da();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=ra();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(ss.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):Fr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{nr:r,sr:s}}))}function Qh(t,e){const n=Br(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function Wh(t,e){const n=Br(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Bs.getTargetData(t,e).next((s=>s?(r=s,Ts.resolve(r)):n.Bs.allocateTargetId(t).next((s=>(r=new Yc(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Bs.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.Ji.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}async function Hh(t,e,n){const r=Br(t),s=r.Ji.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Ds(t))throw t;Fr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Ji=r.Ji.remove(e),r.Yi.delete(s.target)}function Xh(t,e,n){const r=Br(t);let s=ss.min(),i=da();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const r=Br(t),s=r.Yi.get(n);return void 0!==s?Ts.resolve(r.Ji.get(s)):r.Bs.getTargetData(e,n)}(r,t,Ko(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.Hi.getDocumentsMatchingQuery(t,e,n?s:ss.min(),n?i:da()))).next((t=>(Zh(r,Jo(e),t),{documents:t,ir:i})))))}function Yh(t,e){const n=Br(t),r=Br(n.Bs),s=n.Ji.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",(t=>r.le(t,e).next((t=>t?t.target:null))))}function Jh(t,e){const n=Br(t),r=n.Xi.get(e)||ss.min();return n.persistence.runTransaction("Get new document changes","readonly",(t=>n.Zi.getAllFromCollectionGroup(t,e,gs(r,-1),Number.MAX_SAFE_INTEGER))).then((t=>(Zh(n,e,t),t)))}function Zh(t,e,n){let r=t.Xi.get(e)||ss.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Xi.set(e,r)}async function tl(t,e,n=da()){const r=await Wh(t,Ko(ou(e.bundledQuery))),s=Br(t);return s.persistence.runTransaction("Save named query","readwrite",(t=>{const i=xc(e.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.qs.saveNamedQuery(t,e);const o=r.withResumeToken(_i.EMPTY_BYTE_STRING,i);return s.Ji=s.Ji.insert(o.targetId,o),s.Bs.updateTargetData(t,o).next((()=>s.Bs.removeMatchingKeysForTargetId(t,r.targetId))).next((()=>s.Bs.addMatchingKeys(t,n,r.targetId))).next((()=>s.qs.saveNamedQuery(t,e)))}))}function el(t,e){return`firestore_clients_${t}_${e}`}function nl(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function rl(t,e){return`firestore_targets_${t}_${e}`}class sl{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static ar(t,e,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new jr(r.error.code,r.error.message))),i?new sl(t,e,r.state,s):(Or("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}hr(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class il{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static ar(t,e){const n=JSON.parse(e);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new jr(n.error.code,n.error.message))),s?new il(t,n.state,r):(Or("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}hr(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class ol{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static ar(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=ma();for(let t=0;r&&t<n.activeTargetIds.length;++t)r=Ps(n.activeTargetIds[t]),s=s.add(n.activeTargetIds[t]);return r?new ol(t,s):(Or("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class al{constructor(t,e){this.clientId=t,this.onlineState=e}static ar(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new al(e.clientId,e.onlineState):(Or("SharedClientState",`Failed to parse online state: ${t}`),null)}}class cl{constructor(){this.activeTargetIds=ma()}lr(t){this.activeTargetIds=this.activeTargetIds.add(t)}dr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}hr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ul{constructor(t,e,n,r,s){this.window=t,this.ii=e,this.persistenceKey=n,this.wr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new pi(ts),this.started=!1,this.yr=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.pr=el(this.persistenceKey,this.wr),this.Ir=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.gr=this.gr.insert(this.wr,new cl),this.Tr=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.Er=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.Ar=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.vr=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Rr=function(t){return`firestore_bundle_loaded_v2_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this._r)}static D(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.$i();for(const e of t){if(e===this.wr)continue;const t=this.getItem(el(this.persistenceKey,e));if(t){const n=ol.ar(e,t);n&&(this.gr=this.gr.insert(n.clientId,n))}}this.Pr();const e=this.storage.getItem(this.vr);if(e){const t=this.br(e);t&&this.Vr(t)}for(const t of this.yr)this.mr(t);this.yr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.Ir,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(t){let e=!1;return this.gr.forEach(((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.Dr(t,"pending")}updateMutationState(t,e,n){this.Dr(t,e,n),this.Cr(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(rl(this.persistenceKey,t));if(n){const r=il.ar(t,n);r&&(e=r.state)}}return this.Nr.lr(t),this.Pr(),e}removeLocalQueryTarget(t){this.Nr.dr(t),this.Pr()}isLocalQueryTarget(t){return this.Nr.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(rl(this.persistenceKey,t))}updateQueryState(t,e,n){this.kr(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Cr(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Mr(t)}notifyBundleLoaded(t){this.$r(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return Fr("SharedClientState","READ",t,e),e}setItem(t,e){Fr("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){Fr("SharedClientState","REMOVE",t),this.storage.removeItem(t)}mr(t){const e=t;if(e.storageArea===this.storage){if(Fr("SharedClientState","EVENT",e.key,e.newValue),e.key===this.pr)return void Or("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.Tr.test(e.key)){if(null==e.newValue){const t=this.Or(e.key);return this.Fr(t,null)}{const t=this.Br(e.key,e.newValue);if(t)return this.Fr(t.clientId,t)}}else if(this.Er.test(e.key)){if(null!==e.newValue){const t=this.Lr(e.key,e.newValue);if(t)return this.qr(t)}}else if(this.Ar.test(e.key)){if(null!==e.newValue){const t=this.Ur(e.key,e.newValue);if(t)return this.Kr(t)}}else if(e.key===this.vr){if(null!==e.newValue){const t=this.br(e.newValue);if(t)return this.Vr(t)}}else if(e.key===this.Ir){const t=function(t){let e=Fs.ct;if(null!=t)try{const n=JSON.parse(t);qr("number"==typeof n),e=n}catch(t){Or("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Fs.ct&&this.sequenceNumberHandler(t)}else if(e.key===this.Rr){const t=this.Gr(e.newValue);await Promise.all(t.map((t=>this.syncEngine.Qr(t))))}}else this.yr.push(e)}))}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(t,e,n){const r=new sl(this.currentUser,t,e,n),s=nl(this.persistenceKey,this.currentUser,t);this.setItem(s,r.hr())}Cr(t){const e=nl(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Mr(t){const e={clientId:this.wr,onlineState:t};this.storage.setItem(this.vr,JSON.stringify(e))}kr(t,e,n){const r=rl(this.persistenceKey,t),s=new il(t,e,n);this.setItem(r,s.hr())}$r(t){const e=JSON.stringify(Array.from(t));this.setItem(this.Rr,e)}Or(t){const e=this.Tr.exec(t);return e?e[1]:null}Br(t,e){const n=this.Or(t);return ol.ar(n,e)}Lr(t,e){const n=this.Er.exec(t),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return sl.ar(new Nr(s),r,e)}Ur(t,e){const n=this.Ar.exec(t),r=Number(n[1]);return il.ar(r,e)}br(t){return al.ar(t)}Gr(t){return JSON.parse(t)}async qr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.jr(t.batchId,t.state,t.error);Fr("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}Kr(t){return this.syncEngine.zr(t.targetId,t.state,t.error)}Fr(t,e){const n=e?this.gr.insert(t,e):this.gr.remove(t),r=this.Sr(this.gr),s=this.Sr(n),i=[],o=[];return s.forEach((t=>{r.has(t)||i.push(t)})),r.forEach((t=>{s.has(t)||o.push(t)})),this.syncEngine.Wr(i,o).then((()=>{this.gr=n}))}Vr(t){this.gr.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Sr(t){let e=ma();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class hl{constructor(){this.Hr=new cl,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hr.lr(t),this.Jr[t]||"not-current"}updateQueryState(t,e,n){this.Jr[t]=e}removeLocalQueryTarget(t){this.Hr.dr(t)}isLocalQueryTarget(t){return this.Hr.activeTargetIds.has(t)}clearQueryState(t){delete this.Jr[t]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(t){return this.Hr.activeTargetIds.has(t)}start(){return this.Hr=new cl,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class ll{Yr(t){}shutdown(){}}class dl{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(t){this.so.push(t)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){Fr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.so)t(0)}no(){Fr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.so)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let fl=null;function ml(){return null===fl?fl=268435456+Math.round(2147483648*Math.random()):fl++,"0x"+fl.toString(16)}const gl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pl{constructor(t){this.ro=t.ro,this.oo=t.oo}uo(t){this.co=t}ao(t){this.ho=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.ro(t)}fo(){this.co()}wo(t){this.ho(t)}_o(t){this.lo(t)}}const yl="WebChannelConnection";class wl extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.mo=e+"://"+t.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(t,e,n,r,s){const i=ml(),o=this.To(t,e);Fr("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={};return this.Eo(a,r,s),this.Ao(t,o,a,n).then((e=>(Fr("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw Lr("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,s,i){return this.Io(t,e,n,r,s)}Eo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+kr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}To(t,e){const n=gl[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Ao(t,e,n,r){const s=ml();return new Promise(((i,o)=>{const a=new xr;a.setWithCredentials(!0),a.listenOnce(Ir.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case br.NO_ERROR:const e=a.getResponseJson();Fr(yl,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case br.TIMEOUT:Fr(yl,`RPC '${t}' ${s} timed out`),o(new jr(Ur.DEADLINE_EXCEEDED,"Request time out"));break;case br.HTTP_ERROR:const n=a.getStatus();if(Fr(yl,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Ur).indexOf(e)>=0?e:Ur.UNKNOWN}(e.status);o(new jr(t,e.message))}else o(new jr(Ur.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new jr(Ur.UNAVAILABLE,"Connection failed."));break;default:Vr()}}finally{Fr(yl,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);Fr(yl,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}Ro(t,e,n){const r=ml(),s=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=wr(),o=vr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new _r({})),this.Eo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=s.join("");Fr(yl,`Creating RPC '${t}' stream ${r}: ${u}`,a);const h=i.createWebChannel(u,a);let l=!1,d=!1;const f=new pl({ro:e=>{d?Fr(yl,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(Fr(yl,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),Fr(yl,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},oo:()=>h.close()}),m=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return m(h,Sr.EventType.OPEN,(()=>{d||Fr(yl,`RPC '${t}' stream ${r} transport opened.`)})),m(h,Sr.EventType.CLOSE,(()=>{d||(d=!0,Fr(yl,`RPC '${t}' stream ${r} transport closed`),f.wo())})),m(h,Sr.EventType.ERROR,(e=>{d||(d=!0,Lr(yl,`RPC '${t}' stream ${r} transport errored:`,e),f.wo(new jr(Ur.UNAVAILABLE,"The operation could not be completed")))})),m(h,Sr.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];qr(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){Fr(yl,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Ya[t];if(void 0!==e)return tc(e)}(e),s=o.message;void 0===n&&(n=Ur.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.wo(new jr(n,s)),h.close()}else Fr(yl,`RPC '${t}' stream ${r} received:`,s),f._o(s)}})),m(o,Tr.STAT_EVENT,(e=>{e.stat===Er.PROXY?Fr(yl,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Er.NOPROXY&&Fr(yl,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function vl(){return"undefined"!=typeof window?window:null}function bl(){return"undefined"!=typeof document?document:null}function Il(t){return new Ic(t,!0)}class Tl{constructor(t,e,n=1e3,r=1.5,s=6e4){this.ii=t,this.timerId=e,this.Po=n,this.bo=r,this.Vo=s,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(t){this.cancel();const e=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,e-n);r>0&&Fr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,(()=>(this.Co=Date.now(),t()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class El{constructor(t,e,n,r,s,i,o,a){this.ii=t,this.$o=n,this.Oo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Tl(t,e)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(t){this.Ho(),this.stream.send(t)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(t,e){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==t?this.qo.reset():e&&e.code===Ur.RESOURCE_EXHAUSTED?(Or(e.toString()),Or("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):e&&e.code===Ur.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.ao(e)}Yo(){}auth(){this.state=1;const t=this.Xo(this.Fo),e=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Fo===e&&this.Zo(t,n)}),(e=>{t((()=>{const t=new jr(Ur.UNKNOWN,"Fetching auth token failed: "+e.message);return this.tu(t)}))}))}Zo(t,e){const n=this.Xo(this.Fo);this.stream=this.eu(t,e),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((t=>{n((()=>this.tu(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(t){return Fr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.Fo===t?e():(Fr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class _l extends El{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}eu(t,e){return this.connection.Ro("Listen",t,e)}onMessage(t){this.qo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Vr()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(qr(void 0===e||"string"==typeof e),_i.fromBase64String(e||"")):(qr(void 0===e||e instanceof Uint8Array),_i.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Ur.UNKNOWN:tc(t.code);return new jr(e,t.message||"")}(o);n=new fc(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Nc(t,r.document.name),i=xc(r.document.updateTime),o=r.document.createTime?xc(r.document.createTime):ss.min(),a=new eo({mapValue:{fields:r.document.fields}}),c=ro.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new lc(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Nc(t,r.document),i=r.readTime?xc(r.readTime):ss.min(),o=ro.newNoDocument(s,i),a=r.removedTargetIds||[];n=new lc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Nc(t,r.document),i=r.removedTargetIds||[];n=new lc([],i,s,null)}else{if(!("filter"in e))return Vr();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new Xa(r,s),o=t.targetId;n=new dc(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return ss.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ss.min():e.readTime?xc(e.readTime):ss.min()}(t);return this.listener.nu(e,n)}su(t){const e={};e.database=Mc(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Mo(r)?{documents:qc(t,r)}:{query:Bc(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=_c(t,e.resumeToken);const r=Tc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(ss.min())>0){n.readTime=Ec(t,e.snapshotVersion.toTimestamp());const r=Tc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Vr()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Wo(e)}iu(t){const e={};e.database=Mc(this.serializer),e.removeTarget=t,this.Wo(e)}}class Sl extends El{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(t,e){return this.connection.Ro("Write",t,e)}onMessage(t){if(qr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ru){this.qo.reset();const e=function(t,e){return t&&t.length>0?(qr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?xc(t.updateTime):xc(e);return n.isEqual(ss.min())&&(n=xc(e)),new ka(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=xc(t.commitTime);return this.listener.cu(n,e)}return qr(!t.writeResults||0===t.writeResults.length),this.ru=!0,this.listener.au()}hu(){const t={};t.database=Mc(this.serializer),this.Wo(t)}uu(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Pc(this.serializer,t)))};this.Wo(e)}}class xl extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new jr(Ur.FAILED_PRECONDITION,"The client has already been terminated.")}Io(t,e,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.Io(t,e,n,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Ur.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new jr(Ur.UNKNOWN,t.toString())}))}vo(t,e,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.vo(t,e,n,s,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Ur.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new jr(Ur.UNKNOWN,t.toString())}))}terminate(){this.lu=!0}}class Dl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(t){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.yu("Offline")))}set(t){this.Tu(),this.wu=0,"Online"===t&&(this.mu=!1),this.yu(t)}yu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}pu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Or(e),this.mu=!1):Fr("OnlineStateTracker",e)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Cl{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=s,this.Pu.Yr((t=>{n.enqueueAndForget((async()=>{Pl(this)&&(Fr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Br(t);e.vu.add(4),await Nl(e),e.bu.set("Unknown"),e.vu.delete(4),await Al(e)}(this))}))})),this.bu=new Dl(n,r)}}async function Al(t){if(Pl(t))for(const e of t.Ru)await e(!0)}async function Nl(t){for(const e of t.Ru)await e(!1)}function kl(t,e){const n=Br(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),Ll(n)?Ol(n):ed(n).Ko()&&Ml(n,e))}function Rl(t,e){const n=Br(t),r=ed(n);n.Au.delete(e),r.Ko()&&Fl(n,e),0===n.Au.size&&(r.Ko()?r.jo():Pl(n)&&n.bu.set("Unknown"))}function Ml(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ss.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}ed(t).su(e)}function Fl(t,e){t.Vu.qt(e),ed(t).iu(e)}function Ol(t){t.Vu=new gc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),ed(t).start(),t.bu.gu()}function Ll(t){return Pl(t)&&!ed(t).Uo()&&t.Au.size>0}function Pl(t){return 0===Br(t).vu.size}function Vl(t){t.Vu=void 0}async function ql(t){t.Au.forEach(((e,n)=>{Ml(t,e)}))}async function Bl(t,e){Vl(t),Ll(t)?(t.bu.Iu(e),Ol(t)):t.bu.set("Unknown")}async function Ul(t,e,n){if(t.bu.set("Online"),e instanceof fc&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Au.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Au.delete(r),t.Vu.removeTarget(r))}(t,e)}catch(n){Fr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await jl(t,n)}else if(e instanceof lc?t.Vu.Ht(e):e instanceof dc?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(ss.min()))try{const e=await Kh(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Vu.ce(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.Au.get(r);s&&t.Au.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.Au.get(e);if(!r)return;t.Au.set(e,r.withResumeToken(_i.EMPTY_BYTE_STRING,r.snapshotVersion)),Fl(t,e);const s=new Yc(r.target,e,n,r.sequenceNumber);Ml(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Fr("RemoteStore","Failed to raise snapshot:",e),await jl(t,e)}}async function jl(t,e,n){if(!Ds(e))throw e;t.vu.add(1),await Nl(t),t.bu.set("Offline"),n||(n=()=>Kh(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Fr("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await Al(t)}))}function Gl(t,e){return e().catch((n=>jl(t,n,e)))}async function zl(t){const e=Br(t),n=nd(e);let r=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;Kl(e);)try{const t=await Qh(e.localStore,r);if(null===t){0===e.Eu.length&&n.jo();break}r=t.batchId,$l(e,t)}catch(t){await jl(e,t)}Ql(e)&&Wl(e)}function Kl(t){return Pl(t)&&t.Eu.length<10}function $l(t,e){t.Eu.push(e);const n=nd(t);n.Ko()&&n.ou&&n.uu(e.mutations)}function Ql(t){return Pl(t)&&!nd(t).Uo()&&t.Eu.length>0}function Wl(t){nd(t).start()}async function Hl(t){nd(t).hu()}async function Xl(t){const e=nd(t);for(const n of t.Eu)e.uu(n.mutations)}async function Yl(t,e,n){const r=t.Eu.shift(),s=Wa.from(r,e,n);await Gl(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await zl(t)}async function Jl(t,e){e&&nd(t).ou&&await async function(t,e){if(Za(n=e.code)&&n!==Ur.ABORTED){const n=t.Eu.shift();nd(t).Qo(),await Gl(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await zl(t)}var n}(t,e),Ql(t)&&Wl(t)}async function Zl(t,e){const n=Br(t);n.asyncQueue.verifyOperationInProgress(),Fr("RemoteStore","RemoteStore received new credentials");const r=Pl(n);n.vu.add(3),await Nl(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await Al(n)}async function td(t,e){const n=Br(t);e?(n.vu.delete(2),await Al(n)):e||(n.vu.add(2),await Nl(n),n.bu.set("Unknown"))}function ed(t){return t.Su||(t.Su=function(t,e,n){const r=Br(t);return r.fu(),new _l(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{uo:ql.bind(null,t),ao:Bl.bind(null,t),nu:Ul.bind(null,t)}),t.Ru.push((async e=>{e?(t.Su.Qo(),Ll(t)?Ol(t):t.bu.set("Unknown")):(await t.Su.stop(),Vl(t))}))),t.Su}function nd(t){return t.Du||(t.Du=function(t,e,n){const r=Br(t);return r.fu(),new Sl(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{uo:Hl.bind(null,t),ao:Jl.bind(null,t),au:Xl.bind(null,t),cu:Yl.bind(null,t)}),t.Ru.push((async e=>{e?(t.Du.Qo(),await zl(t)):(await t.Du.stop(),t.Eu.length>0&&(Fr("RemoteStore",`Stopping write stream with ${t.Eu.length} pending writes`),t.Eu=[]))}))),t.Du}class rd{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Gr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new rd(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jr(Ur.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sd(t,e){if(Or("AsyncQueue",`${e}: ${t}`),Ds(t))return new jr(Ur.UNAVAILABLE,`${e}: ${t}`);throw t}class id{constructor(t){this.comparator=t?(e,n)=>t(e,n)||us.comparator(e.key,n.key):(t,e)=>us.comparator(t.key,e.key),this.keyedMap=ia(),this.sortedSet=new pi(this.comparator)}static emptySet(t){return new id(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof id))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new id;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class od{constructor(){this.Cu=new pi(us.comparator)}track(t){const e=t.doc.key,n=this.Cu.get(e);n?0!==t.type&&3===n.type?this.Cu=this.Cu.insert(e,t):3===t.type&&1!==n.type?this.Cu=this.Cu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Cu=this.Cu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Cu=this.Cu.remove(e):1===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):Vr():this.Cu=this.Cu.insert(e,t)}xu(){const t=[];return this.Cu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class ad{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new ad(t,e,id.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Wo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class cd{constructor(){this.Nu=void 0,this.listeners=[]}}class ud{constructor(){this.queries=new ea((t=>Ho(t)),Wo),this.onlineState="Unknown",this.ku=new Set}}async function hd(t,e){const n=Br(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new cd),s)try{i.Nu=await n.onListen(r)}catch(t){const n=sd(t,`Initialization of query '${Xo(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.listeners.push(e),e.Mu(n.onlineState),i.Nu&&e.$u(i.Nu)&&md(n)}async function ld(t,e){const n=Br(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function dd(t,e){const n=Br(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.$u(t)&&(r=!0);s.Nu=t}}r&&md(n)}function fd(t,e,n){const r=Br(t),s=r.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);r.queries.delete(e)}function md(t){t.ku.forEach((t=>{t.next()}))}class gd{constructor(t,e,n){this.query=t,this.Ou=e,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new ad(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Fu?this.Lu(t)&&(this.Ou.next(t),e=!0):this.qu(t,this.onlineState)&&(this.Uu(t),e=!0),this.Bu=t,e}onError(t){this.Ou.error(t)}Mu(t){this.onlineState=t;let e=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,t)&&(this.Uu(this.Bu),e=!0),e}qu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Ku||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Lu(t){if(t.docChanges.length>0)return!0;const e=this.Bu&&this.Bu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Uu(t){t=ad.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Fu=!0,this.Ou.next(t)}}class pd{constructor(t,e){this.Gu=t,this.byteLength=e}Qu(){return"metadata"in this.Gu}}class yd{constructor(t){this.serializer=t}rr(t){return Nc(this.serializer,t)}ur(t){return t.metadata.exists?Lc(this.serializer,t.document,!1):ro.newNoDocument(this.rr(t.metadata.name),this.cr(t.metadata.readTime))}cr(t){return xc(t)}}class wd{constructor(t,e,n){this.ju=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=vd(t)}zu(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.Gu.namedQuery)this.queries.push(t.Gu.namedQuery);else if(t.Gu.documentMetadata){this.documents.push({metadata:t.Gu.documentMetadata}),t.Gu.documentMetadata.exists||++e;const n=os.fromString(t.Gu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.Gu.document&&(this.documents[this.documents.length-1].document=t.Gu.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Wu(t){const e=new Map,n=new yd(this.serializer);for(const r of t)if(r.metadata.queries){const t=n.rr(r.metadata.name);for(const n of r.metadata.queries){const r=(e.get(n)||da()).add(t);e.set(n,r)}}return e}async complete(){const t=await async function(t,e,n,r){const s=Br(t);let i=da(),o=ra();for(const t of n){const n=e.rr(t.metadata.name);t.document&&(i=i.add(n));const r=e.ur(t);r.setReadTime(e.cr(t.metadata.readTime)),o=o.insert(n,r)}const a=s.Zi.newChangeBuffer({trackRemovals:!0}),c=await Wh(s,function(t){return Ko(qo(os.fromString(`__bundle__/docs/${t}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(t=>$h(t,a,o).next((e=>(a.apply(t),e))).next((e=>s.Bs.removeMatchingKeysForTargetId(t,c.targetId).next((()=>s.Bs.addMatchingKeys(t,i,c.targetId))).next((()=>s.localDocuments.getLocalViewOfDocuments(t,e.nr,e.sr))).next((()=>e.nr))))))}(this.localStore,new yd(this.serializer),this.documents,this.ju.id),e=this.Wu(this.documents);for(const t of this.queries)await tl(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Hu:this.collectionGroups,Ju:t}}}function vd(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class bd{constructor(t){this.key=t}}class Id{constructor(t){this.key=t}}class Td{constructor(t,e){this.query=t,this.Yu=e,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=da(),this.mutatedKeys=da(),this.tc=Zo(t),this.ec=new id(this.tc)}get nc(){return this.Yu}sc(t,e){const n=e?e.ic:new od,r=e?e.ec:this.ec;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=Yo(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.rc(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.tc(h,a)>0||c&&this.tc(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{ec:i,ic:n,zi:o,mutatedKeys:s}}rc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.ec;this.ec=t.ec,this.mutatedKeys=t.mutatedKeys;const s=t.ic.xu();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vr()}};return n(t)-n(e)}(t.type,e.type)||this.tc(t.doc,e.doc))),this.oc(n);const i=e?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==s.length||a?{snapshot:new ad(this.query,t.ec,r,s,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:i}:{cc:i}}Mu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ec:this.ec,ic:new od,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(t){return!this.Yu.has(t)&&!!this.ec.has(t)&&!this.ec.get(t).hasLocalMutations}oc(t){t&&(t.addedDocuments.forEach((t=>this.Yu=this.Yu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Yu=this.Yu.delete(t))),this.current=t.current)}uc(){if(!this.current)return[];const t=this.Zu;this.Zu=da(),this.ec.forEach((t=>{this.ac(t.key)&&(this.Zu=this.Zu.add(t.key))}));const e=[];return t.forEach((t=>{this.Zu.has(t)||e.push(new Id(t))})),this.Zu.forEach((n=>{t.has(n)||e.push(new bd(n))})),e}hc(t){this.Yu=t.ir,this.Zu=da();const e=this.sc(t.documents);return this.applyChanges(e,!0)}lc(){return ad.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Ed{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class _d{constructor(t){this.key=t,this.fc=!1}}class Sd{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.dc={},this.wc=new ea((t=>Ho(t)),Wo),this._c=new Map,this.mc=new Set,this.gc=new pi(us.comparator),this.yc=new Map,this.Ic=new _h,this.Tc={},this.Ec=new Map,this.Ac=Zu.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function xd(t,e){const n=Jd(t);let r,s;const i=n.wc.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.lc();else{const t=await Wh(n.localStore,Ko(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await Dd(n,e,r,"current"===i,t.resumeToken),n.isPrimaryClient&&kl(n.remoteStore,t)}return s}async function Dd(t,e,n,r,s){t.Rc=(e,n,r)=>async function(t,e,n,r){let s=e.view.sc(n);s.zi&&(s=await Xh(t.localStore,e.query,!1).then((({documents:t})=>e.view.sc(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,i);return Vd(t,e.targetId,o.cc),o.snapshot}(t,e,n,r);const i=await Xh(t.localStore,e,!0),o=new Td(e,i.ir),a=o.sc(i.documents),c=hc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),u=o.applyChanges(a,t.isPrimaryClient,c);Vd(t,n,u.cc);const h=new Ed(e,n,o);return t.wc.set(e,h),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),u.snapshot}async function Cd(t,e){const n=Br(t),r=n.wc.get(e),s=n._c.get(r.targetId);if(s.length>1)return n._c.set(r.targetId,s.filter((t=>!Wo(t,e)))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Hh(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Rl(n.remoteStore,r.targetId),Ld(n,r.targetId)})).catch(Is)):(Ld(n,r.targetId),await Hh(n.localStore,r.targetId,!0))}async function Ad(t,e){const n=Br(t);try{const t=await function(t,e){const n=Br(t),r=e.snapshotVersion;let s=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Zi.newChangeBuffer({trackRemovals:!0});s=n.Ji;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(t,i.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(_i.EMPTY_BYTE_STRING,ss.min()).withLastLimboFreeSnapshotVersion(ss.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Bs.updateTargetData(t,u))}));let a=ra(),c=da();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push($h(t,i,e.documentUpdates).next((t=>{a=t.nr,c=t.sr}))),!r.isEqual(ss.min())){const e=n.Bs.getLastRemoteSnapshotVersion(t).next((e=>n.Bs.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Ts.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ji=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.yc.get(e);r&&(qr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.fc=!0:t.modifiedDocuments.size>0?qr(r.fc):t.removedDocuments.size>0&&(qr(r.fc),r.fc=!1))})),await Ud(n,t,e)}catch(t){await Is(t)}}function Nd(t,e,n){const r=Br(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.wc.forEach(((n,r)=>{const s=r.view.Mu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Br(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Mu(e)&&(r=!0)})),r&&md(n)}(r.eventManager,e),t.length&&r.dc.nu(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function kd(t,e,n){const r=Br(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.yc.get(e),i=s&&s.key;if(i){let t=new pi(us.comparator);t=t.insert(i,ro.newNoDocument(i,ss.min()));const n=da().add(i),s=new uc(ss.min(),new Map,new pi(ts),t,n);await Ad(r,s),r.gc=r.gc.remove(i),r.yc.delete(e),Bd(r)}else await Hh(r.localStore,e,!1).then((()=>Ld(r,e,n))).catch(Is)}async function Rd(t,e){const n=Br(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Br(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.Zi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Ts.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);qr(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=da();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Od(n,r,null),Fd(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ud(n,t)}catch(t){await Is(t)}}async function Md(t,e,n){const r=Br(t);try{const t=await function(t,e){const n=Br(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(qr(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Od(r,e,n),Fd(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Ud(r,t)}catch(n){await Is(n)}}function Fd(t,e){(t.Ec.get(e)||[]).forEach((t=>{t.resolve()})),t.Ec.delete(e)}function Od(t,e,n){const r=Br(t);let s=r.Tc[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.Tc[r.currentUser.toKey()]=s}}function Ld(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t._c.get(e))t.wc.delete(r),n&&t.dc.Pc(r,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach((e=>{t.Ic.containsKey(e)||Pd(t,e)}))}function Pd(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);null!==n&&(Rl(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),Bd(t))}function Vd(t,e,n){for(const r of n)r instanceof bd?(t.Ic.addReference(r.key,e),qd(t,r)):r instanceof Id?(Fr("SyncEngine","Document no longer in limbo: "+r.key),t.Ic.removeReference(r.key,e),t.Ic.containsKey(r.key)||Pd(t,r.key)):Vr()}function qd(t,e){const n=e.key,r=n.path.canonicalString();t.gc.get(n)||t.mc.has(r)||(Fr("SyncEngine","New document in limbo: "+n),t.mc.add(r),Bd(t))}function Bd(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new us(os.fromString(e)),r=t.Ac.next();t.yc.set(r,new _d(n)),t.gc=t.gc.insert(n,r),kl(t.remoteStore,new Yc(Ko(qo(n.path)),r,"TargetPurposeLimboResolution",Fs.ct))}}async function Ud(t,e,n){const r=Br(t),s=[],i=[],o=[];r.wc.isEmpty()||(r.wc.forEach(((t,a)=>{o.push(r.Rc(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Bh.Li(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.dc.nu(s),await async function(t,e){const n=Br(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Ts.forEach(e,(e=>Ts.forEach(e.Fi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Ts.forEach(e.Bi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Ds(t))throw t;Fr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.Ji=n.Ji.insert(e,s)}}}(r.localStore,i))}async function jd(t,e){const n=Br(t);if(!n.currentUser.isEqual(e)){Fr("SyncEngine","User change. New user:",e.toKey());const t=await zh(n.localStore,e);n.currentUser=e,function(t,e){t.Ec.forEach((t=>{t.forEach((t=>{t.reject(new jr(Ur.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ec.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Ud(n,t.er)}}function Gd(t,e){const n=Br(t),r=n.yc.get(e);if(r&&r.fc)return da().add(r.key);{let t=da();const r=n._c.get(e);if(!r)return t;for(const e of r){const r=n.wc.get(e);t=t.unionWith(r.view.nc)}return t}}async function zd(t,e){const n=Br(t),r=await Xh(n.localStore,e.query,!0),s=e.view.hc(r);return n.isPrimaryClient&&Vd(n,e.targetId,s.cc),s}async function Kd(t,e){const n=Br(t);return Jh(n.localStore,e).then((t=>Ud(n,t)))}async function $d(t,e,n,r){const s=Br(t),i=await function(t,e){const n=Br(t),r=Br(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>r.Sn(t,e).next((e=>e?n.localDocuments.getDocuments(t,e):Ts.resolve(null)))))}(s.localStore,e);null!==i?("pending"===n?await zl(s.remoteStore):"acknowledged"===n||"rejected"===n?(Od(s,e,r||null),Fd(s,e),function(t,e){Br(Br(t).mutationQueue).Cn(e)}(s.localStore,e)):Vr(),await Ud(s,i)):Fr("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Qd(t,e,n){const r=Br(t),s=[],i=[];for(const t of e){let e;const n=r._c.get(t);if(n&&0!==n.length){e=await Wh(r.localStore,Ko(n[0]));for(const t of n){const e=r.wc.get(t),n=await zd(r,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await Yh(r.localStore,t);e=await Wh(r.localStore,n),await Dd(r,Wd(n),t,!1,e.resumeToken)}s.push(e)}return r.dc.nu(i),s}function Wd(t){return Vo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Hd(t){const e=Br(t);return Br(Br(e.localStore).persistence).$i()}async function Xd(t,e,n,r){const s=Br(t);if(s.vc)return void Fr("SyncEngine","Ignoring unexpected query state notification.");const i=s._c.get(e);if(i&&i.length>0)switch(n){case"current":case"not-current":{const t=await Jh(s.localStore,Jo(i[0])),r=uc.createSynthesizedRemoteEventForCurrentChange(e,"current"===n,_i.EMPTY_BYTE_STRING);await Ud(s,t,r);break}case"rejected":await Hh(s.localStore,e,!0),Ld(s,e,r);break;default:Vr()}}async function Yd(t,e,n){const r=Jd(t);if(r.vc){for(const t of e){if(r._c.has(t)){Fr("SyncEngine","Adding an already active target "+t);continue}const e=await Yh(r.localStore,t),n=await Wh(r.localStore,e);await Dd(r,Wd(e),n.targetId,!1,n.resumeToken),kl(r.remoteStore,n)}for(const t of n)r._c.has(t)&&await Hh(r.localStore,t,!1).then((()=>{Rl(r.remoteStore,t),Ld(r,t)})).catch(Is)}}function Jd(t){const e=Br(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ad.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gd.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kd.bind(null,e),e.dc.nu=dd.bind(null,e.eventManager),e.dc.Pc=fd.bind(null,e.eventManager),e}function Zd(t){const e=Br(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Rd.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Md.bind(null,e),e}class tf{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Il(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Gh(this.persistence,new Uh,t.initialUser,this.serializer)}createPersistence(t){return new Nh(Rh.zs,this.serializer)}createSharedClientState(t){return new hl}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class ef extends tf{constructor(t,e,n){super(),this.Vc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Vc.initialize(this,t),await Zd(this.Vc.syncEngine),await zl(this.Vc.remoteStore),await this.persistence.Ii((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(t){return Gh(this.persistence,new Uh,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new oh(n,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){const n=new Ms(e,this.persistence);return new Rs(t.asyncQueue,n)}createPersistence(t){const e=qh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ku.withCacheSize(this.cacheSizeBytes):Ku.DEFAULT;return new Lh(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,vl(),bl(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new hl}}class nf extends ef{constructor(t,e){super(t,e,!1),this.Vc=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Vc.syncEngine;this.sharedClientState instanceof ul&&(this.sharedClientState.syncEngine={jr:$d.bind(null,e),zr:Xd.bind(null,e),Wr:Yd.bind(null,e),$i:Hd.bind(null,e),Qr:Kd.bind(null,e)},await this.sharedClientState.start()),await this.persistence.Ii((async t=>{await async function(t,e){const n=Br(t);if(Jd(n),Zd(n),!0===e&&!0!==n.vc){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await Qd(n,t.toArray());n.vc=!0,await td(n.remoteStore,!0);for(const t of e)kl(n.remoteStore,t)}else if(!1===e&&!1!==n.vc){const t=[];let e=Promise.resolve();n._c.forEach(((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?t.push(s):e=e.then((()=>(Ld(n,s),Hh(n.localStore,s,!0)))),Rl(n.remoteStore,s)})),await e,await Qd(n,t),function(t){const e=Br(t);e.yc.forEach(((t,n)=>{Rl(e.remoteStore,n)})),e.Ic.Ts(),e.yc=new Map,e.gc=new pi(us.comparator)}(n),n.vc=!1,await td(n.remoteStore,!1)}}(this.Vc.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start():t||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(t&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():t||this.indexBackfillerScheduler.stop())}))}createSharedClientState(t){const e=vl();if(!ul.D(e))throw new jr(Ur.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=qh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new ul(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class rf{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Nd(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=jd.bind(null,this.syncEngine),await td(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ud}createDatastore(t){const e=Il(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new wl(r));var r;return function(t,e,n,r){return new xl(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>Nd(this.syncEngine,t,0),i=dl.D()?new dl:new ll,new Cl(e,n,r,s,i);var e,n,r,s,i}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new Sd(t,e,n,r,s,i);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Br(t);Fr("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await Nl(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}function sf(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class of{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Sc(this.observer.next,t)}error(t){this.observer.error?this.Sc(this.observer.error,t):Or("Uncaught Error in snapshot listener:",t.toString())}Dc(){this.muted=!0}Sc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class af{constructor(t,e){this.Cc=t,this.serializer=e,this.metadata=new Gr,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then((t=>{t&&t.Qu()?this.metadata.resolve(t.Gu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.Gu)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Cc.cancel()}async getMetadata(){return this.metadata.promise}async bc(){return await this.getMetadata(),this.Nc()}async Nc(){const t=await this.kc();if(null===t)return null;const e=this.xc.decode(t),n=Number(e);isNaN(n)&&this.Mc(`length string (${e}) is not valid number`);const r=await this.$c(n);return new pd(JSON.parse(r),t.length+n)}Oc(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async kc(){for(;this.Oc()<0&&!await this.Fc(););if(0===this.buffer.length)return null;const t=this.Oc();t<0&&this.Mc("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async $c(t){for(;this.buffer.length<t;)await this.Fc()&&this.Mc("Reached the end of bundle when more is expected.");const e=this.xc.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}Mc(t){throw this.Cc.cancel(),new Error(`Invalid bundle format: ${t}`)}async Fc(){const t=await this.Cc.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class cf{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new jr(Ur.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Br(t),r=Mc(n.serializer)+"/documents",s={documents:e.map((t=>Ac(n.serializer,t)))},i=await n.vo("BatchGetDocuments",r,s,e.length),o=new Map;i.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){qr(!!e.found),e.found.name,e.found.updateTime;const n=Nc(t,e.found.name),r=xc(e.found.updateTime),s=e.found.createTime?xc(e.found.createTime):ss.min(),i=new eo({mapValue:{fields:e.found.fields}});return ro.newFoundDocument(n,r,s,i)}(t,e):"missing"in e?function(t,e){qr(!!e.missing),qr(!!e.readTime);const n=Nc(t,e.missing),r=xc(e.readTime);return ro.newNoDocument(n,r)}(t,e):Vr()}(n.serializer,t);o.set(e.key.toString(),e)}));const a=[];return e.forEach((t=>{const e=o.get(t.toString());qr(!!e),a.push(e)})),a}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ka(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=us.fromPath(e);this.mutations.push(new $a(n,this.precondition(n)))})),await async function(t,e){const n=Br(t),r=Mc(n.serializer)+"/documents",s={writes:e.map((t=>Pc(n.serializer,t)))};await n.Io("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Vr();e=ss.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new jr(Ur.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(ss.min())?Ra.exists(!1):Ra.updateTime(e):Ra.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ss.min()))throw new jr(Ur.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ra.updateTime(e)}return Ra.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class uf{constructor(t,e,n,r,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=r,this.deferred=s,this.Bc=n.maxAttempts,this.qo=new Tl(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){this.qo.No((async()=>{const t=new cf(this.datastore),e=this.qc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.Uc(t)}))))})).catch((t=>{this.Uc(t)}))}))}qc(t){try{const e=this.updateFunction(t);return!Os(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Uc(t){this.Bc>0&&this.Kc(t)?(this.Bc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Lc(),Promise.resolve())))):this.deferred.reject(t)}Kc(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!Za(e)}return!1}}class hf{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Nr.UNAUTHENTICATED,this.clientId=Zr.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Fr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Fr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new jr(Ur.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Gr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=sd(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function lf(t,e){t.asyncQueue.verifyOperationInProgress(),Fr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await zh(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function df(t,e){t.asyncQueue.verifyOperationInProgress();const n=await mf(t);Fr("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>Zl(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Zl(e.remoteStore,n))),t._onlineComponents=e}function ff(t){return"FirebaseError"===t.name?t.code===Ur.FAILED_PRECONDITION||t.code===Ur.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}async function mf(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Fr("FirestoreClient","Using user provided OfflineComponentProvider");try{await lf(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!ff(n))throw n;Lr("Error using user provided cache. Falling back to memory cache: "+n),await lf(t,new tf)}}else Fr("FirestoreClient","Using default OfflineComponentProvider"),await lf(t,new tf);return t._offlineComponents}async function gf(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Fr("FirestoreClient","Using user provided OnlineComponentProvider"),await df(t,t._uninitializedComponentsProvider._online)):(Fr("FirestoreClient","Using default OnlineComponentProvider"),await df(t,new rf))),t._onlineComponents}function pf(t){return mf(t).then((t=>t.persistence))}function yf(t){return mf(t).then((t=>t.localStore))}function wf(t){return gf(t).then((t=>t.remoteStore))}function vf(t){return gf(t).then((t=>t.syncEngine))}function bf(t){return gf(t).then((t=>t.datastore))}async function If(t){const e=await gf(t),n=e.eventManager;return n.onListen=xd.bind(null,e.syncEngine),n.onUnlisten=Cd.bind(null,e.syncEngine),n}function Tf(t,e,n={}){const r=new Gr;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new of({next:i=>{e.enqueueAndForget((()=>ld(t,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new jr(Ur.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new jr(Ur.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:t=>s.reject(t)}),o=new gd(qo(n.path),i,{includeMetadataChanges:!0,Ku:!0});return hd(t,o)}(await If(t),t.asyncQueue,e,n,r))),r.promise}function Ef(t,e,n={}){const r=new Gr;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new of({next:n=>{e.enqueueAndForget((()=>ld(t,o))),n.fromCache&&"server"===r.source?s.reject(new jr(Ur.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new gd(n,i,{includeMetadataChanges:!0,Ku:!0});return hd(t,o)}(await If(t),t.asyncQueue,e,n,r))),r.promise}function _f(t,e,n,r){const s=function(t,e){let n;return n="string"==typeof t?rc().encode(t):t,function(t,e){return new af(t,e)}(function(t,e){if(t instanceof Uint8Array)return sf(t,e);if(t instanceof ArrayBuffer)return sf(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,Il(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const r=Br(t);(async function(t,e,n){try{const r=await e.getMetadata();if(await function(t,e){const n=Br(t),r=xc(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.qs.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(r)>=0))}(t.localStore,r))return await e.close(),n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(vd(r));const s=new wd(r,t.localStore,e.serializer);let i=await e.bc();for(;i;){const t=await s.zu(i);t&&n._updateProgress(t),i=await e.bc()}const o=await s.complete();return await Ud(t,o.Ju,void 0),await function(t,e){const n=Br(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.qs.saveBundleMetadata(t,e)))}(t.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Hu)}catch(t){return Lr("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}})(r,e,n).then((t=>{r.sharedClientState.notifyBundleLoaded(t)}))}(await vf(t),s,r)}))}function Sf(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const xf=new Map;function Df(t,e,n){if(!n)throw new jr(Ur.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Cf(t,e,n,r){if(!0===e&&!0===r)throw new jr(Ur.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Af(t){if(!us.isDocumentKey(t))throw new jr(Ur.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Nf(t){if(us.isDocumentKey(t))throw new jr(Ur.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function kf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Vr()}function Rf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new jr(Ur.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=kf(t);throw new jr(Ur.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Mf(t,e){if(e<=0)throw new jr(Ur.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Ff{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new jr(Ur.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.cache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new jr(Ur.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Cf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Sf(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new jr(Ur.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new jr(Ur.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new jr(Ur.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(e=this.experimentalLongPollingOptions,n=t.experimentalLongPollingOptions,e.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams;var e,n}}class Of{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ff({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new jr(Ur.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new jr(Ur.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ff(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Kr;switch(t.type){case"firstParty":return new Hr(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new jr(Ur.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=xf.get(t);e&&(Fr("ComponentProvider","Removing Datastore"),xf.delete(t),e.terminate())}(this),Promise.resolve()}}function Lf(t,e,n,r={}){var s;const i=(t=Rf(t,Of))._getSettings(),o=`${e}:${n}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&Lr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Nr.MOCK_USER;else{e=(0,c.Sg)(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new jr(Ur.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Nr(i)}t._authCredentials=new $r(new zr(e,n))}}class Pf{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qf(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Pf(this.firestore,t,this._key)}}class Vf{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Vf(this.firestore,t,this._query)}}class qf extends Vf{constructor(t,e,n){super(t,e,qo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Pf(this.firestore,null,new us(t))}withConverter(t){return new qf(this.firestore,t,this._path)}}function Bf(t,e,...n){if(t=(0,c.m9)(t),Df("collection","path",e),t instanceof Of){const r=os.fromString(e,...n);return Nf(r),new qf(t,null,r)}{if(!(t instanceof Pf||t instanceof qf))throw new jr(Ur.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(os.fromString(e,...n));return Nf(r),new qf(t.firestore,null,r)}}function Uf(t,e,...n){if(t=(0,c.m9)(t),1===arguments.length&&(e=Zr.A()),Df("doc","path",e),t instanceof Of){const r=os.fromString(e,...n);return Af(r),new Pf(t,null,new us(r))}{if(!(t instanceof Pf||t instanceof qf))throw new jr(Ur.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(os.fromString(e,...n));return Af(r),new Pf(t.firestore,t instanceof qf?t.converter:null,new us(r))}}function jf(t,e){return t=(0,c.m9)(t),e=(0,c.m9)(e),(t instanceof Pf||t instanceof qf)&&(e instanceof Pf||e instanceof qf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Gf(t,e){return t=(0,c.m9)(t),e=(0,c.m9)(e),t instanceof Vf&&e instanceof Vf&&t.firestore===e.firestore&&Wo(t._query,e._query)&&t.converter===e.converter}class zf{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Tl(this,"async_queue_retry"),this.Xc=()=>{const t=bl();t&&Fr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const t=bl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Zc(),this.ta(t)}enterRestrictedMode(t){if(!this.jc){this.jc=!0,this.Jc=t||!1;const e=bl();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xc)}}enqueue(t){if(this.Zc(),this.jc)return new Promise((()=>{}));const e=new Gr;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Qc.push(t),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(t){if(!Ds(t))throw t;Fr("AsyncQueue","Operation failed with retryable error: "+t)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(t){const e=this.Gc.then((()=>(this.Hc=!0,t().catch((t=>{this.Wc=t,this.Hc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Or("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Hc=!1,t))))));return this.Gc=e,e}enqueueAfterDelay(t,e,n){this.Zc(),this.Yc.indexOf(t)>-1&&(e=0);const r=rd.createAndSchedule(this,t,e,n,(t=>this.na(t)));return this.zc.push(r),r}Zc(){this.Wc&&Vr()}verifyOperationInProgress(){}async sa(){let t;do{t=this.Gc,await t}while(t!==this.Gc)}ia(t){for(const e of this.zc)if(e.timerId===t)return!0;return!1}ra(t){return this.sa().then((()=>{this.zc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.zc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.sa()}))}oa(t){this.Yc.push(t)}na(t){const e=this.zc.indexOf(t);this.zc.splice(e,1)}}function Kf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class $f{constructor(){this._progressObserver={},this._taskCompletionResolver=new Gr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}class Qf extends Of{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new zf,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Hf(this),this._firestoreClient.terminate()}}function Wf(t){return t._firestoreClient||Hf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Hf(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new Ri(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Sf(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new hf(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=s.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.cache.kind,_offline:s.cache._offlineComponentProvider,_online:s.cache._onlineComponentProvider})}function Xf(t,e,n){const r=new Gr;return t.asyncQueue.enqueue((async()=>{try{await lf(t,n),await df(t,e),r.resolve()}catch(t){const e=t;if(!ff(e))throw e;Lr("Error enabling indexeddb cache. Falling back to memory cache: "+e),r.reject(e)}})).then((()=>r.promise))}function Yf(t){return function(t){const e=new Gr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Br(t);Pl(n.remoteStore)||Fr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=Br(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const r=n.Ec.get(t)||[];r.push(e),n.Ec.set(t,r)}catch(t){const n=sd(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await vf(t),e))),e.promise}(Wf(t=Rf(t,Qf)))}function Jf(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await pf(t),n=await wf(t);return e.setNetworkEnabled(!0),function(t){const e=Br(t);return e.vu.delete(0),Al(e)}(n)}))}(Wf(t=Rf(t,Qf)))}function Zf(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await pf(t),n=await wf(t);return e.setNetworkEnabled(!1),async function(t){const e=Br(t);e.vu.add(0),await Nl(e),e.bu.set("Offline")}(n)}))}(Wf(t=Rf(t,Qf)))}function tm(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=Br(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.qs.getNamedQuery(t,e)))}(await yf(t),e)))}(Wf(t=Rf(t,Qf)),e).then((e=>e?new Vf(t,null,e.query):null))}function em(t){if(t._initialized||t._terminated)throw new jr(Ur.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class nm{constructor(t){this._byteString=t}static fromBase64String(t){try{return new nm(_i.fromBase64String(t))}catch(t){throw new jr(Ur.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new nm(_i.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class rm{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new jr(Ur.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new cs(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class sm{constructor(t){this._methodName=t}}class im{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new jr(Ur.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new jr(Ur.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ts(this._lat,t._lat)||ts(this._long,t._long)}}const om=/^__.*__$/;class am{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Ua(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ba(t,this.data,e,this.fieldTransforms)}}class cm{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Ua(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function um(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Vr()}}class hm{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.ua(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(t){return new hm(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.aa({path:n,la:!1});return r.fa(t),r}da(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.aa({path:n,la:!1});return r.ua(),r}wa(t){return this.aa({path:void 0,la:!0})}_a(t){return Nm(t,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ua(){if(this.path)for(let t=0;t<this.path.length;t++)this.fa(this.path.get(t))}fa(t){if(0===t.length)throw this._a("Document fields must not be empty");if(um(this.ca)&&om.test(t))throw this._a('Document fields cannot begin and end with "__"')}}class lm{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Il(t)}ya(t,e,n,r=!1){return new hm({ca:t,methodName:e,ga:n,path:cs.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dm(t){const e=t._freezeSettings(),n=Il(t._databaseId);return new lm(t._databaseId,!!e.ignoreUndefinedProperties,n)}function fm(t,e,n,r,s,i={}){const o=t.ya(i.merge||i.mergeFields?2:0,e,n,s);xm("Data must be an object, but it was:",o,r);const a=_m(r,o);let c,u;if(i.merge)c=new Ti(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=Dm(e,r,n);if(!o.contains(s))throw new jr(Ur.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);km(t,s)||t.push(s)}c=new Ti(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new am(new eo(a),c,u)}class mm extends sm{_toFieldTransform(t){if(2!==t.ca)throw 1===t.ca?t._a(`${this._methodName}() can only appear at the top level of your update data`):t._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof mm}}function gm(t,e,n){return new hm({ca:3,ga:e.settings.ga,methodName:t._methodName,la:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class pm extends sm{_toFieldTransform(t){return new Na(t.path,new Ta)}isEqual(t){return t instanceof pm}}class ym extends sm{constructor(t,e){super(t),this.pa=e}_toFieldTransform(t){const e=gm(this,t,!0),n=this.pa.map((t=>Em(t,e))),r=new Ea(n);return new Na(t.path,r)}isEqual(t){return this===t}}class wm extends sm{constructor(t,e){super(t),this.pa=e}_toFieldTransform(t){const e=gm(this,t,!0),n=this.pa.map((t=>Em(t,e))),r=new Sa(n);return new Na(t.path,r)}isEqual(t){return this===t}}class vm extends sm{constructor(t,e){super(t),this.Ia=e}_toFieldTransform(t){const e=new Da(t.serializer,ya(t.serializer,this.Ia));return new Na(t.path,e)}isEqual(t){return this===t}}function bm(t,e,n,r){const s=t.ya(1,e,n);xm("Data must be an object, but it was:",s,r);const i=[],o=eo.empty();mi(r,((t,r)=>{const a=Am(e,t,n);r=(0,c.m9)(r);const u=s.da(a);if(r instanceof mm)i.push(a);else{const t=Em(r,u);null!=t&&(i.push(a),o.set(a,t))}}));const a=new Ti(i);return new cm(o,a,s.fieldTransforms)}function Im(t,e,n,r,s,i){const o=t.ya(1,e,n),a=[Dm(e,r,n)],u=[s];if(i.length%2!=0)throw new jr(Ur.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(Dm(e,i[t])),u.push(i[t+1]);const h=[],l=eo.empty();for(let t=a.length-1;t>=0;--t)if(!km(h,a[t])){const e=a[t];let n=u[t];n=(0,c.m9)(n);const r=o.da(e);if(n instanceof mm)h.push(e);else{const t=Em(n,r);null!=t&&(h.push(e),l.set(e,t))}}const d=new Ti(h);return new cm(l,d,o.fieldTransforms)}function Tm(t,e,n,r=!1){return Em(n,t.ya(r?4:3,e))}function Em(t,e){if(Sm(t=(0,c.m9)(t)))return xm("Unsupported field value:",e,t),_m(t,e);if(t instanceof sm)return function(t,e){if(!um(e.ca))throw e._a(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e._a(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=Em(s,e.wa(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,c.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ya(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=rs.fromDate(t);return{timestampValue:Ec(e.serializer,n)}}if(t instanceof rs){const n=new rs(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ec(e.serializer,n)}}if(t instanceof im)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof nm)return{bytesValue:_c(e.serializer,t._byteString)};if(t instanceof Pf){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Dc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e._a(`Unsupported field value: ${kf(t)}`)}(t,e)}function _m(t,e){const n={};return gi(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):mi(t,((t,r)=>{const s=Em(r,e.ha(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function Sm(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof rs||t instanceof im||t instanceof nm||t instanceof Pf||t instanceof sm)}function xm(t,e,n){if(!Sm(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=kf(n);throw"an object"===r?e._a(t+" a custom object"):e._a(t+" "+r)}}function Dm(t,e,n){if((e=(0,c.m9)(e))instanceof rm)return e._internalPath;if("string"==typeof e)return Am(t,e);throw Nm("Field path arguments must be of type string or ",t,!1,void 0,n)}const Cm=new RegExp("[~\\*/\\[\\]]");function Am(t,e,n){if(e.search(Cm)>=0)throw Nm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new rm(...e.split("."))._internalPath}catch(r){throw Nm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Nm(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new jr(Ur.INVALID_ARGUMENT,a+t+c)}function km(t,e){return t.some((t=>t.isEqual(e)))}class Rm{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Pf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Mm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Fm("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Mm extends Rm{data(){return super.data()}}function Fm(t,e){return"string"==typeof e?Am(t,e):e instanceof rm?e._internalPath:e._delegate._internalPath}function Om(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new jr(Ur.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Lm{}class Pm extends Lm{}function Vm(t,e,...n){let r=[];e instanceof Lm&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof Bm)).length,n=t.filter((t=>t instanceof qm)).length;if(e>1||e>0&&n>0)throw new jr(Ur.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}class qm extends Pm{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new qm(t,e,n)}_apply(t){const e=this._parse(t);return Wm(t._query,e),new Vf(t.firestore,t.converter,$o(t._query,e))}_parse(t){const e=dm(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new jr(Ur.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){Qm(o,i);const e=[];for(const n of o)e.push($m(r,t,n));a={arrayValue:{values:e}}}else a=$m(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Qm(o,i),a=Tm(n,"where",o,"in"===i||"not-in"===i);return ho.create(s,i,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class Bm extends Lm{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Bm(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:lo.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)Wm(n,t),n=$o(n,t)}(t._query,e),new Vf(t.firestore,t.converter,$o(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Um extends Pm{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Um(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new jr(Ur.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new jr(Ur.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new ao(e,n);return function(t,e){if(null===Uo(t)){const n=jo(t);null!==n&&Hm(t,n,e.field)}}(t,r),r}(t._query,this._field,this._direction);return new Vf(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Po(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}class jm extends Pm{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new jm(t,e,n)}_apply(t){return new Vf(t.firestore,t.converter,Qo(t._query,this._limit,this._limitType))}}class Gm extends Pm{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new Gm(t,e,n)}_apply(t){const e=Km(t,this.type,this._docOrFields,this._inclusive);return new Vf(t.firestore,t.converter,function(t,e){return new Po(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}class zm extends Pm{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new zm(t,e,n)}_apply(t){const e=Km(t,this.type,this._docOrFields,this._inclusive);return new Vf(t.firestore,t.converter,function(t,e){return new Po(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function Km(t,e,n,r){if(n[0]=(0,c.m9)(n[0]),n[0]instanceof Rm)return function(t,e,n,r,s){if(!r)throw new jr(Ur.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of zo(t))if(n.field.isKeyField())i.push(Gi(e,r.key));else{const t=r.data.field(n.field);if(Ai(t))throw new jr(Ur.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new so(i,s)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=dm(t.firestore);return function(t,e,n,r,s,i){const o=t.explicitOrderBy;if(s.length>o.length)throw new jr(Ur.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const c=s[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Go(t)&&-1!==c.indexOf("/"))throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(os.fromString(c));if(!us.isDocumentKey(n))throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new us(n);a.push(Gi(e,s))}else{const t=Tm(n,r,c);a.push(t)}}return new so(a,i)}(t._query,t.firestore._databaseId,s,e,n,r)}}function $m(t,e,n){if("string"==typeof(n=(0,c.m9)(n))){if(""===n)throw new jr(Ur.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Go(e)&&-1!==n.indexOf("/"))throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(os.fromString(n));if(!us.isDocumentKey(r))throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Gi(t,new us(r))}if(n instanceof Pf)return Gi(t,n._key);throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${kf(n)}.`)}function Qm(t,e){if(!Array.isArray(t)||0===t.length)throw new jr(Ur.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Wm(t,e){if(e.isInequality()){const n=jo(t),r=e.field;if(null!==n&&!n.isEqual(r))throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const s=Uo(t);null!==s&&Hm(t,r,s)}const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new jr(Ur.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new jr(Ur.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function Hm(t,e,n){if(!n.isEqual(e))throw new jr(Ur.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Xm{convertValue(t,e="none"){switch(Li(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Di(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ci(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Vr()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return mi(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new im(Di(t.latitude),Di(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ni(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ki(t));default:return null}}convertTimestamp(t){const e=xi(t);return new rs(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=os.fromString(t);qr(Xc(n));const r=new Mi(n.get(1),n.get(3)),s=new us(n.popFirst(5));return r.isEqual(e)||Or(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function Ym(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Jm extends Xm{constructor(t){super(),this.firestore=t}convertBytes(t){return new nm(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Pf(this.firestore,null,e)}}class Zm{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class tg extends Rm{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new eg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Fm("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class eg extends tg{data(t={}){return super.data(t)}}class ng{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Zm(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new eg(this._firestore,this._userDataWriter,n.key,n,new Zm(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new jr(Ur.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new eg(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Zm(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new eg(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Zm(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:rg(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function rg(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Vr()}}function sg(t,e){return t instanceof tg&&e instanceof tg?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof ng&&e instanceof ng&&t._firestore===e._firestore&&Gf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}class ig extends Xm{constructor(t){super(),this.firestore=t}convertBytes(t){return new nm(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Pf(this.firestore,null,e)}}function og(t){t=Rf(t,Pf);const e=Rf(t.firestore,Qf),n=Wf(e),r=new ig(e);return function(t,e){const n=new Gr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await function(t,e){const n=Br(t);return n.persistence.runTransaction("read document","readonly",(t=>n.localDocuments.getDocument(t,e)))}(t,e);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new jr(Ur.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const r=sd(t,`Failed to get document '${e} from cache`);n.reject(r)}}(await yf(t),e,n))),n.promise}(n,t._key).then((n=>new tg(e,r,t._key,n,new Zm(null!==n&&n.hasLocalMutations,!0),t.converter)))}function ag(t){t=Rf(t,Vf);const e=Rf(t.firestore,Qf),n=Wf(e),r=new ig(e);return function(t,e){const n=new Gr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await Xh(t,e,!0),s=new Td(e,r.ir),i=s.sc(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const r=sd(t,`Failed to execute query '${e} against cache`);n.reject(r)}}(await yf(t),e,n))),n.promise}(n,t._query).then((n=>new ng(e,r,t,n)))}function cg(t,e,n){t=Rf(t,Pf);const r=Rf(t.firestore,Qf),s=Ym(t.converter,e,n);return dg(r,[fm(dm(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,Ra.none())])}function ug(t,e,n,...r){t=Rf(t,Pf);const s=Rf(t.firestore,Qf),i=dm(s);let o;return o="string"==typeof(e=(0,c.m9)(e))||e instanceof rm?Im(i,"updateDoc",t._key,e,n,r):bm(i,"updateDoc",t._key,e),dg(s,[o.toMutation(t._key,Ra.exists(!0))])}function hg(t,...e){var n,r,s;t=(0,c.m9)(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Kf(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Kf(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let u,h,l;if(t instanceof Pf)h=Rf(t.firestore,Qf),l=qo(t._key.path),u={next:n=>{e[o]&&e[o](fg(h,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Rf(t,Vf);h=Rf(n.firestore,Qf),l=n._query;const r=new ig(h);u={next:t=>{e[o]&&e[o](new ng(h,r,n,t))},error:e[o+1],complete:e[o+2]},Om(t._query)}return function(t,e,n,r){const s=new of(r),i=new gd(e,s,n);return t.asyncQueue.enqueueAndForget((async()=>hd(await If(t),i))),()=>{s.Dc(),t.asyncQueue.enqueueAndForget((async()=>ld(await If(t),i)))}}(Wf(h),l,a,u)}function lg(t,e){return function(t,e){const n=new of(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){Br(t).ku.add(e),e.next()}(await If(t),n))),()=>{n.Dc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){Br(t).ku.delete(e)}(await If(t),n)))}}(Wf(t=Rf(t,Qf)),Kf(e)?e:{next:e})}function dg(t,e){return function(t,e){const n=new Gr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Zd(t);try{const t=await function(t,e){const n=Br(t),r=rs.now(),s=e.reduce(((t,e)=>t.add(e.key)),da());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=ra(),c=da();return n.Zi.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=Va(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new Ua(t.key,e,no(e.value.mapValue),Ra.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:oa(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Tc[t.currentUser.toKey()];r||(r=new pi(ts)),r=r.insert(e,n),t.Tc[t.currentUser.toKey()]=r}(r,t.batchId,n),await Ud(r,t.changes),await zl(r.remoteStore)}catch(t){const e=sd(t,"Failed to persist write");n.reject(e)}}(await vf(t),e,n))),n.promise}(Wf(t),e)}function fg(t,e,n){const r=n.docs.get(e._key),s=new ig(t);return new tg(t,s,e._key,r,new Zm(n.hasPendingWrites,n.fromCache),e.converter)}const mg={maxAttempts:5};class gg{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=dm(t)}set(t,e,n){this._verifyNotCommitted();const r=pg(t,this._firestore),s=Ym(r.converter,e,n),i=fm(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,Ra.none())),this}update(t,e,n,...r){this._verifyNotCommitted();const s=pg(t,this._firestore);let i;return i="string"==typeof(e=(0,c.m9)(e))||e instanceof rm?Im(this._dataReader,"WriteBatch.update",s._key,e,n,r):bm(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(i.toMutation(s._key,Ra.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=pg(t,this._firestore);return this._mutations=this._mutations.concat(new Ka(e._key,Ra.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new jr(Ur.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function pg(t,e){if((t=(0,c.m9)(t)).firestore!==e)throw new jr(Ur.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class yg extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=dm(t)}get(t){const e=pg(t,this._firestore),n=new Jm(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return Vr();const r=t[0];if(r.isFoundDocument())return new Rm(this._firestore,n,r.key,r,e.converter);if(r.isNoDocument())return new Rm(this._firestore,n,e._key,null,e.converter);throw Vr()}))}set(t,e,n){const r=pg(t,this._firestore),s=Ym(r.converter,e,n),i=fm(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(t,e,n,...r){const s=pg(t,this._firestore);let i;return i="string"==typeof(e=(0,c.m9)(e))||e instanceof rm?Im(this._dataReader,"Transaction.update",s._key,e,n,r):bm(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,i),this}delete(t){const e=pg(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=pg(t,this._firestore),n=new ig(this._firestore);return super.get(t).then((t=>new tg(this._firestore,n,e._key,t._document,new Zm(!1,!1),e.converter)))}}!function(t,e=!0){!function(t){kr=t}(i.SDK_VERSION),(0,i._registerComponent)(new o.wA("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Qf(new Qr(t.getProvider("auth-internal")),new Yr(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new jr(Ur.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mi(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),(0,i.registerVersion)(Ar,"3.13.0",t),(0,i.registerVersion)(Ar,"3.13.0","esm2017")}();function wg(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new jr("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function vg(){if("undefined"==typeof Uint8Array)throw new jr("unimplemented","Uint8Arrays are not available in this environment.")}function bg(){if("undefined"==typeof atob)throw new jr("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Ig{constructor(t){this._delegate=t}static fromBase64String(t){return bg(),new Ig(nm.fromBase64String(t))}static fromUint8Array(t){return vg(),new Ig(nm.fromUint8Array(t))}toBase64(){return bg(),this._delegate.toBase64()}toUint8Array(){return vg(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Tg(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of e)if(t in n&&"function"==typeof n[t])return!0;return!1}(t,["next","error","complete"])}class Eg{enableIndexedDbPersistence(t,e){return function(t,e){em(t=Rf(t,Qf));const n=Wf(t);if(n._uninitializedComponentsProvider)throw new jr(Ur.FAILED_PRECONDITION,"SDK cache is already specified.");Lr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=t._freezeSettings(),s=new rf;return Xf(n,s,new ef(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return function(t){em(t=Rf(t,Qf));const e=Wf(t);if(e._uninitializedComponentsProvider)throw new jr(Ur.FAILED_PRECONDITION,"SDK cache is already specified.");Lr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings(),r=new rf;return Xf(e,r,new nf(r,n.cacheSizeBytes))}(t._delegate)}clearIndexedDbPersistence(t){return function(t){if(t._initialized&&!t._terminated)throw new jr(Ur.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Gr;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!_s.D())return Promise.resolve();const e=t+"main";await _s.delete(e)}(qh(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}(t._delegate)}}class _g{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof Mi||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||Lr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){Lf(this._delegate,t,e,n)}enableNetwork(){return Jf(this._delegate)}disableNetwork(){return Zf(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,Cf("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Yf(this._delegate)}onSnapshotsInSync(t){return lg(this._delegate,t)}get app(){if(!this._appCompat)throw new jr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new Vg(this,Bf(this._delegate,t))}catch(t){throw Ng(t,"collection()","Firestore.collection()")}}doc(t){try{return new Ag(this,Uf(this._delegate,t))}catch(t){throw Ng(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new Og(this,function(t,e){if(t=Rf(t,Of),Df("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new jr(Ur.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Vf(t,null,function(t){return new Po(os.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Ng(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return function(t,e,n){t=Rf(t,Qf);const r=Object.assign(Object.assign({},mg),n);return function(t){if(t.maxAttempts<1)throw new jr(Ur.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(t,e,n){const r=new Gr;return t.asyncQueue.enqueueAndForget((async()=>{const s=await bf(t);new uf(t.asyncQueue,s,n,e,r).run()})),r.promise}(Wf(t),(n=>e(new yg(t,n))),r)}(this._delegate,(e=>t(new xg(this,e))))}batch(){return Wf(this._delegate),new Dg(new gg(this._delegate,(t=>dg(this._delegate,t))))}loadBundle(t){return function(t,e){const n=Wf(t=Rf(t,Qf)),r=new $f;return _f(n,t._databaseId,e,r),r}(this._delegate,t)}namedQuery(t){return tm(this._delegate,t).then((t=>t?new Og(this,t):null))}}class Sg extends Xm{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ig(new nm(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return Ag.forKey(e,this.firestore,null)}}class xg{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Sg(t)}get(t){const e=qg(t);return this._delegate.get(e).then((t=>new Mg(this._firestore,new tg(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter))))}set(t,e,n){const r=qg(t);return n?(wg("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this}update(t,e,n,...r){const s=qg(t);return 2===arguments.length?this._delegate.update(s,e):this._delegate.update(s,e,n,...r),this}delete(t){const e=qg(t);return this._delegate.delete(e),this}}class Dg{constructor(t){this._delegate=t}set(t,e,n){const r=qg(t);return n?(wg("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this}update(t,e,n,...r){const s=qg(t);return 2===arguments.length?this._delegate.update(s,e):this._delegate.update(s,e,n,...r),this}delete(t){const e=qg(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class Cg{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new eg(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Fg(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=Cg.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let s=r.get(e);return s||(s=new Cg(t,new Sg(t),e),r.set(e,s)),s}}Cg.INSTANCES=new WeakMap;class Ag{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Sg(t)}static forPath(t,e,n){if(t.length%2!=0)throw new jr("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new Ag(e,new Pf(e._delegate,n,new us(t)))}static forKey(t,e,n){return new Ag(e,new Pf(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new Vg(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new Vg(this.firestore,Bf(this._delegate,t))}catch(t){throw Ng(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=(0,c.m9)(t))instanceof Pf&&jf(this._delegate,t)}set(t,e){e=wg("DocumentReference.set",e);try{return e?cg(this._delegate,t,e):cg(this._delegate,t)}catch(t){throw Ng(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?ug(this._delegate,t):ug(this._delegate,t,e,...n)}catch(t){throw Ng(t,"updateDoc()","DocumentReference.update()")}}delete(){return dg(Rf((t=this._delegate).firestore,Qf),[new Ka(t._key,Ra.none())]);var t}onSnapshot(...t){const e=kg(t),n=Rg(t,(t=>new Mg(this.firestore,new tg(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))));return hg(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?og(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Rf(t,Pf);const e=Rf(t.firestore,Qf);return Tf(Wf(e),t._key,{source:"server"}).then((n=>fg(e,t,n)))}(this._delegate):function(t){t=Rf(t,Pf);const e=Rf(t.firestore,Qf);return Tf(Wf(e),t._key).then((n=>fg(e,t,n)))}(this._delegate),e.then((t=>new Mg(this.firestore,new tg(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))))}withConverter(t){return new Ag(this.firestore,t?this._delegate.withConverter(Cg.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function Ng(t,e,n){return t.message=t.message.replace(e,n),t}function kg(t){for(const e of t)if("object"==typeof e&&!Tg(e))return e;return{}}function Rg(t,e){var n,r;let s;return s=Tg(t[0])?t[0]:Tg(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{s.next&&s.next(e(t))},error:null===(n=s.error)||void 0===n?void 0:n.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Mg{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new Ag(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return sg(this._delegate,t._delegate)}}class Fg extends Mg{data(t){const e=this._delegate.data(t);return void 0!==e||Vr(),e}}class Og{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Sg(t)}where(t,e,n){try{return new Og(this.firestore,Vm(this._delegate,function(t,e,n){const r=e,s=Fm("where",t);return qm._create(s,r,n)}(t,e,n)))}catch(t){throw Ng(t,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new Og(this.firestore,Vm(this._delegate,function(t,e="asc"){const n=e,r=Fm("orderBy",t);return Um._create(r,n)}(t,e)))}catch(t){throw Ng(t,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new Og(this.firestore,Vm(this._delegate,(Mf("limit",e=t),jm._create("limit",e,"F"))))}catch(t){throw Ng(t,"limit()","Query.limit()")}var e}limitToLast(t){try{return new Og(this.firestore,Vm(this._delegate,(Mf("limitToLast",e=t),jm._create("limitToLast",e,"L"))))}catch(t){throw Ng(t,"limitToLast()","Query.limitToLast()")}var e}startAt(...t){try{return new Og(this.firestore,Vm(this._delegate,function(...t){return Gm._create("startAt",t,!0)}(...t)))}catch(t){throw Ng(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new Og(this.firestore,Vm(this._delegate,function(...t){return Gm._create("startAfter",t,!1)}(...t)))}catch(t){throw Ng(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new Og(this.firestore,Vm(this._delegate,function(...t){return zm._create("endBefore",t,!1)}(...t)))}catch(t){throw Ng(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new Og(this.firestore,Vm(this._delegate,function(...t){return zm._create("endAt",t,!0)}(...t)))}catch(t){throw Ng(t,"endAt()","Query.endAt()")}}isEqual(t){return Gf(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?ag(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Rf(t,Vf);const e=Rf(t.firestore,Qf),n=Wf(e),r=new ig(e);return Ef(n,t._query,{source:"server"}).then((n=>new ng(e,r,t,n)))}(this._delegate):function(t){t=Rf(t,Vf);const e=Rf(t.firestore,Qf),n=Wf(e),r=new ig(e);return Om(t._query),Ef(n,t._query).then((n=>new ng(e,r,t,n)))}(this._delegate),e.then((t=>new Pg(this.firestore,new ng(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))))}onSnapshot(...t){const e=kg(t),n=Rg(t,(t=>new Pg(this.firestore,new ng(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))));return hg(this._delegate,e,n)}withConverter(t){return new Og(this.firestore,t?this._delegate.withConverter(Cg.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class Lg{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new Fg(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Pg{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new Og(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((t=>new Fg(this._firestore,t)))}docChanges(t){return this._delegate.docChanges(t).map((t=>new Lg(this._firestore,t)))}forEach(t,e){this._delegate.forEach((n=>{t.call(e,new Fg(this._firestore,n))}))}isEqual(t){return sg(this._delegate,t._delegate)}}class Vg extends Og{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new Ag(this.firestore,t):null}doc(t){try{return new Ag(this.firestore,void 0===t?Uf(this._delegate):Uf(this._delegate,t))}catch(t){throw Ng(t,"doc()","CollectionReference.doc()")}}add(t){return function(t,e){const n=Rf(t.firestore,Qf),r=Uf(t),s=Ym(t.converter,e);return dg(n,[fm(dm(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,Ra.exists(!1))]).then((()=>r))}(this._delegate,t).then((t=>new Ag(this.firestore,t)))}isEqual(t){return jf(this._delegate,t._delegate)}withConverter(t){return new Vg(this.firestore,t?this._delegate.withConverter(Cg.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function qg(t){return Rf(t,Pf)}class Bg{constructor(...t){this._delegate=new rm(...t)}static documentId(){return new Bg(cs.keyField().canonicalString())}isEqual(t){return(t=(0,c.m9)(t))instanceof rm&&this._delegate._internalPath.isEqual(t._internalPath)}}class Ug{constructor(t){this._delegate=t}static serverTimestamp(){const t=new pm("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Ug(t)}static delete(){const t=new mm("deleteField");return t._methodName="FieldValue.delete",new Ug(t)}static arrayUnion(...t){const e=function(...t){return new ym("arrayUnion",t)}(...t);return e._methodName="FieldValue.arrayUnion",new Ug(e)}static arrayRemove(...t){const e=function(...t){return new wm("arrayRemove",t)}(...t);return e._methodName="FieldValue.arrayRemove",new Ug(e)}static increment(t){const e=new vm("increment",t);return e._methodName="FieldValue.increment",new Ug(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const jg={Firestore:_g,GeoPoint:im,Timestamp:rs,Blob:Ig,Transaction:xg,WriteBatch:Dg,DocumentReference:Ag,DocumentSnapshot:Mg,Query:Og,QueryDocumentSnapshot:Fg,QuerySnapshot:Pg,CollectionReference:Vg,FieldPath:Bg,FieldValue:Ug,setLogLevel:function(t){var e;e=t,Rr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};var Gg,zg;Gg=s.Z,zg=(t,e)=>new _g(t,e,new Eg),Gg.INTERNAL.registerComponent(new o.wA("firestore-compat",(t=>{const e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("firestore").getImmediate();return zg(e,n)}),"PUBLIC").setServiceProps(Object.assign({},jg))),Gg.registerVersion("@firebase/firestore-compat","0.3.12")}}]);